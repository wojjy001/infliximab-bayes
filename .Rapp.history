3/0.998266*468135.7
3/0.188329*468135.7
rm(list=ls(all=TRUE))#
	library(deSolve)	#
	library(ggplot2)	#
	library(plyr)	#
	library(grid)	#
	library(compiler)	#
	library(mrgsolve)	#
	setwd("/Volumes/Prosecutor/PhD/InfliximabBayes/infliximab-bayes/")#
<<<<<<< HEAD
	source("/Volumes/Prosecutor/PhD/InfliximabBayes/infliximab-bayes/Project/model.R")#
	input.optimise.data <- data.frame(#
		ID = 1,#
		time = c(378,434,490,546),	#
		ALB = 3.621317186,	#
		ADA = 1,	#
		ETA1 = 0.688112345,	#
		ETA2 = -0.087150995,	#
		ETA3 = 0.764270184,	#
		ETA4 = -0.964647963,	#
		ERRPRO = -1.03772694,	#
		amt = 0,	#
		evid = c(1,1,1,0),	#
		cmt = 1,	#
		rate = c(-2,-2,-2,0)	#
	)#
	initial.compartment <- list(CENT = 0.53246085,PERI = 0.124347732,AUT = 84.23292059)#
	optim.mod1 <- mod %>% init(initial.compartment) %>% carry.out(amt,ERRPRO)#
	last.dose <- 468135.7002#
	last.IPRE <- 0.18832934#
		if (last.IPRE < 3 | last.IPRE >= 5) {#
			initial.dose <- 3/last.IPRE*last.dose	#
		} else {#
			initial.dose <- last.dose	#
		}#
		initial.par <- c(initial.dose,initial.dose,initial.dose,0.01)#
		lower.limit <- c(0.0001,0.0001,0.0001,0.0001)#
		upper.limit <- c(Inf,Inf,Inf,Inf)#
		par <- initial.par#
	optimise.dose <- function(par) {#
		input.optimise.data$amt[1] <- par[1]#
		input.optimise.data$amt[2] <- par[2]#
		input.optimise.data$amt[3] <- par[3]#
		err <- par[4]#
		new.optimise.data <- optim.mod1 %>% data_set(input.optimise.data) %>% mrgsim()#
		new.optimise.data <- as.data.frame(new.optimise.data)#
		yhat <- new.optimise.data$IPRE[new.optimise.data$time > 378]#
		print(yhat)#
		res <- dnorm(3,yhat,yhat*err,log = T)	#
		objective <- -1*sum(res)#
#
		diagnosticflag <- T#
#
	    if (diagnosticflag == T) {#
	      bayes1buffer <<- c(bayes1buffer,log10(par[1]/initial.par[1]))#
	      bayes2buffer <<- c(bayes2buffer,log10(par[2]/initial.par[2]))#
				bayes3buffer <<- c(bayes3buffer,log10(par[3]/initial.par[3]))#
				bayes4buffer <<- c(bayes4buffer,log10(par[4]/initial.par[4]))#
	      iterationbuffer <- 1:length(bayes1buffer)#
	      if (length(iterationbuffer) %% 5 == 0) { #
          plot(iterationbuffer,bayes1buffer,type = 'l',xlim = c(1,length(iterationbuffer)),ylim = c(-5,5),col = "red",xlab = "Iteration",ylab = "Normalised Parameter Value",main = "Estimating Bayes Parameters\n")#
          points(iterationbuffer,bayes2buffer,type = 'l',col = "blue")#
					points(iterationbuffer,bayes3buffer,type = 'l',col = "darkgreen")#
					points(iterationbuffer,bayes4buffer,type = 'l',col = "orange")#
          legend(1,-1,legend = c("DOSE1","DOSE2","DOSE3","ERR"),lty = c(1,1),col = c("red","blue","darkgreen","orange"))#
	    	}#
			}#
		objective#
	}#
  plot.new() #
  bayes1buffer <<- NA  #
  bayes2buffer <<- NA#
	bayes3buffer <<- NA#
	bayes4buffer <<- NA#
#
	optimised.doses <- optim(par,optimise.dose,hessian = FALSE,method = "L-BFGS-B",lower = lower.limit,upper = upper.limit,control = list(parscale = par,factr = 1e12))#
	optimised.doses
Intiial parameter estimates for dose optimisation#
	last.dose <- 468135.7002#
	last.IPRE <- 0.18832934#
		if (last.IPRE < 3 | last.IPRE >= 5) {#
			initial.dose <- 3/last.IPRE*last.dose	#
		} else {#
			initial.dose <- last.dose	#
		}#
		if (initial.dose > 1000000) {#
			initial.dose <- NA#
		}#
#
	if (is.na(initial.dose) == FALSE & initial.dose != last.dose) {#
			initial.par <- c(initial.dose,initial.dose,initial.dose,0.01)#
			lower.limit <- c(0.0001,0.0001,0.0001,0.0001)#
			upper.limit <- c(Inf,Inf,Inf,Inf)#
			par <- initial.par#
			optimise.dose <- function(par) {#
				input.optimise.data$amt[1] <- par[1]#
				input.optimise.data$amt[2] <- par[2]#
				input.optimise.data$amt[3] <- par[3]#
				err <- par[4]#
				new.optimise.data <- optim.mod1 %>% data_set(input.optimise.data) %>% mrgsim()#
				new.optimise.data <- as.data.frame(new.optimise.data)#
				yhat <- new.optimise.data$IPRE[new.optimise.data$time > 378]#
				print(yhat)#
				res <- dnorm(3,yhat,yhat*err,log = T)	#
				objective <- -1*sum(res)#
#
				diagnosticflag <- T#
#
			    if (diagnosticflag == T) {#
			      bayes1buffer <<- c(bayes1buffer,log10(par[1]/initial.par[1]))#
			      bayes2buffer <<- c(bayes2buffer,log10(par[2]/initial.par[2]))#
						bayes3buffer <<- c(bayes3buffer,log10(par[3]/initial.par[3]))#
						bayes4buffer <<- c(bayes4buffer,log10(par[4]/initial.par[4]))#
			      iterationbuffer <- 1:length(bayes1buffer)#
			      if (length(iterationbuffer) %% 5 == 0) { #
		          plot(iterationbuffer,bayes1buffer,type = 'l',xlim = c(1,length(iterationbuffer)),ylim = c(-5,5),col = "red",xlab = "Iteration",ylab = "Normalised Parameter Value",main = "Estimating Bayes Parameters\n")#
		          points(iterationbuffer,bayes2buffer,type = 'l',col = "blue")#
							points(iterationbuffer,bayes3buffer,type = 'l',col = "darkgreen")#
							points(iterationbuffer,bayes4buffer,type = 'l',col = "orange")#
		          legend(1,-1,legend = c("DOSE1","DOSE2","DOSE3","ERR"),lty = c(1,1),col = c("red","blue","darkgreen","orange"))#
			    	}#
					}#
				objective#
			}#
		  plot.new() #
		  bayes1buffer <<- NA  #
		  bayes2buffer <<- NA#
			bayes3buffer <<- NA#
			bayes4buffer <<- NA#
#
			optimised.doses <- optim(par,optimise.dose,hessian = FALSE,method = "L-BFGS-B",lower = lower.limit,upper = upper.limit,control = list(parscale = par,factr = 1e12))#
	} else {#
		optimised.doses <- NA#
	}
optimised.doses
initial.dose
if (is.na(initial.dose) == FALSE & initial.dose != last.dose) {#
			DOSE1 <- optimised.doses$par[1]#
			DOSE2 <- optimised.doses$par[2]#
			if (interval == 2) {#
				DOSE3 <- NA#
				ERR <- optimised.doses$par[3]#
			}#
			if (interval != 2) {	#
				DOSE3 <- optimised.doses$par[3]#
				ERR <- optimised.doses$par[4]#
			}#
		} else if (initial.dose == last.dose) {#
			DOSE1 <- last.dose#
			DOSE2 <- last.dose#
			DOSE3 <- NA#
			if (interval != 2) {	#
				DOSE3 <- last.dose#
			}#
			ERR <- 0#
		} else {#
			DOSE1 <- 1000000#
			DOSE2 <- 1000000#
			DOSE3 <- NA#
			if (interval != 2) {	#
				DOSE3 <- 1000000#
			}#
			ERR <- 0#
		}
interval <- 4
if (is.na(initial.dose) == FALSE & initial.dose != last.dose) {#
			DOSE1 <- optimised.doses$par[1]#
			DOSE2 <- optimised.doses$par[2]#
			if (interval == 2) {#
				DOSE3 <- NA#
				ERR <- optimised.doses$par[3]#
			}#
			if (interval != 2) {	#
				DOSE3 <- optimised.doses$par[3]#
				ERR <- optimised.doses$par[4]#
			}#
		} else if (is.na(initial.dose) == FALSE & initial.dose == last.dose) {#
			DOSE1 <- last.dose#
			DOSE2 <- last.dose#
			DOSE3 <- NA#
			if (interval != 2) {	#
				DOSE3 <- last.dose#
			}#
			ERR <- 0#
		} else {#
			DOSE1 <- 1000000#
			DOSE2 <- 1000000#
			DOSE3 <- NA#
			if (interval != 2) {	#
				DOSE3 <- 1000000#
			}#
			ERR <- 0#
		}
DOSE1
DOSE2
DOSE3
ERR
=======
	theme_bw2 <- theme_set(theme_bw(base_size = 16))#
	sumfuncx <- function(x) {#
		stat1 <- median(x)#
		stat2 <- quantile(x,probs = 0.025,names = F)#
		stat3 <- quantile(x,probs = 0.975,names = F)#
		stat4 <- length(x)#
		result <- c("median" = stat1,"low" = stat2,"hi" = stat3,"n" = stat4)#
		result#
	}#
	set.seed(123456)#
		code <- '#
		$CMT			// Specify compartments#
							CENT,	// Central#
							PERI, // Peripheral#
							TUT,	// Time below target compartment#
							ALB	// Albumin, U/L#
		$PARAM		// Population parameters#
							POPCL = 0.294,#
							POPV1 = 3.33,#
							POPQ = 0.0719,#
							POPV2 = 1.14,#
							// Covariate effects#
							WT_CL = 0.614,	// Effect of weight on clearance#
							WT_V1 = 0.691,	// Effect of weight on V1#
							WT_Q = 1.1,	// Effect of weight on Q#
							WT_V2 = 0.59,	// Effect of weight on V2#
							ALB_CL = -1.17,	// Effect of albumin on clearance#
							ADA_CL = 0.257,	// Effect of anti-drug antibodies on clearance#
							// Covariate values for simulation#
							WT = 70,	// Weight (kg)#
							BASE_ALB = 4,	// Baseline albumin at treatment initiation#
							ADA = 0,	// Anti-drug antibodies (0 = No, 1 = Yes)#
							target = 3	// Target trough concentration (mg/L)#
		$OMEGA		name = "BSV"#
							block = FALSE#
							labels = s(PPVCL,PPVV1,PPVQ,PPVV2)#
							0.106929#
							0.0225#
							1.21#
							0.638401#
		$SIGMA		block = FALSE#
							labels = s(ERRPRO)#
							0.175561#
		$MAIN			// Infusion duration#
							D_CENT = 0.08333333;  // 2 hours#
							// Compartment initial conditions#
							CENT_0 = 0;#
							PERI_0 = 0;#
							AUT_0 = 0;#
							ALB_0 = BASE_ALB;#
							// Covariate effects#
							double ADACOV = 1;	// No anti-drug antibodies#
							if (ADA == 1) ADACOV = 1+ADA_CL;		// Anti-drug antibodies#
							// Individual parameter values#
							double CL = POPCL*pow(WT/70,WT_CL)*pow(ALB/4,ALB_CL)*ADACOV*exp(PPVCL);#
							double V1 = POPV1*pow(WT/70,WT_V1)*exp(PPVV1);#
							double Q = POPQ*pow(WT/70,WT_Q)*exp(PPVQ);#
							double V2 = POPV2*pow(WT/70,WT_V2)*exp(PPVV2);#
		$ODE			// Differential equations#
							dxdt_CENT = -Q/V1*CENT +Q/V2*PERI -CL/V1*CENT;#
							dxdt_PERI = Q/V1*CENT -Q/V2*PERI;#
							// Time under target#
							double CP = CENT/V1;	// Plasma concentration of the central compartment#
							dxdt_TUT = 0;#
							if (CP < target) dxdt_TUT = 1;#
							// Proportion of time under target#
							double pTUT = TUT/SOLVERTIME;#
							// Albumin#
							dxdt_ALB = ALB*(pTUT-90);#
		$TABLE		table(IPRE) = CENT/V1;#
							table(DV) = table(IPRE)*exp(ERRPRO);#
		$CAPTURE	WT ADA ALB CL V1 Q V2 PPVCL PPVV1 PPVQ PPVV2#
		'#
		mod <- mcode("popINFLIX",code)#
	TIME.tgrid <- tgrid(0,365,1)#
	ID.list <- 1:1000#
	population.function <- function(ID.list) {#
		ID.number <- ID.list[1]#
		input.conc.data <- data.frame(#
			ID = ID.number,#
			amt = 5*70,#
			evid = 1,#
			cmt = 1,#
			time = c(0,14,42,98,154,210,266,322),#
			rate = -2#
		)#
	}#
	input.conc.data <- ldply(ID.list, population.function)#
	conc.data <- mod %>% data_set(input.conc.data) %>% carry.out(amt) %>% mrgsim(tgrid = TIME.tgrid)#
	conc.data <- as.data.frame(conc.data)#
	summary.data <- ddply(conc.data, .(time), function(conc.data) sumfuncx(conc.data$IPRE))#
	plotobj1 <- NULL#
	plotobj1 <- ggplot(summary.data)#
	plotobj1 <- plotobj1 + geom_line(aes(x = time,y = median),colour = "red")#
	plotobj1 <- plotobj1 + geom_ribbon(aes(x = time,ymin = low,ymax = hi),fill = "red",alpha = 0.3)#
	plotobj1 <- plotobj1 + scale_x_continuous("\nTime (hours)")#
	plotobj1 <- plotobj1 + scale_y_log10("Infliximab Concentration (mg/L)\n",breaks = c(0.001,0.01,0.1,1,10,100,100),labels = c(0.001,0.01,0.1,1,10,100,100))#
	plotobj1
rm(list=ls(all=TRUE))#
	library(deSolve)	#
	library(ggplot2)	#
	library(plyr)	#
	library(grid)	#
	library(compiler)	#
	library(mrgsolve)	#
	setwd("/Volumes/Prosecutor/PhD/InfliximabBayes/infliximab-bayes/")#
	theme_bw2 <- theme_set(theme_bw(base_size = 16))#
	sumfuncx <- function(x) {#
		stat1 <- median(x)#
		stat2 <- quantile(x,probs = 0.025,names = F)#
		stat3 <- quantile(x,probs = 0.975,names = F)#
		stat4 <- length(x)#
		result <- c("median" = stat1,"low" = stat2,"hi" = stat3,"n" = stat4)#
		result#
	}#
	set.seed(123456)#
		code <- '#
		$CMT			// Specify compartments#
							CENT,	// Central#
							PERI, // Peripheral#
							TUT,	// Time below target compartment#
							ALB	// Albumin, U/L#
		$PARAM		// Population parameters#
							POPCL = 0.294,#
							POPV1 = 3.33,#
							POPQ = 0.0719,#
							POPV2 = 1.14,#
							// Covariate effects#
							WT_CL = 0.614,	// Effect of weight on clearance#
							WT_V1 = 0.691,	// Effect of weight on V1#
							WT_Q = 1.1,	// Effect of weight on Q#
							WT_V2 = 0.59,	// Effect of weight on V2#
							ALB_CL = -1.17,	// Effect of albumin on clearance#
							ADA_CL = 0.257,	// Effect of anti-drug antibodies on clearance#
							// Covariate values for simulation#
							WT = 70,	// Weight (kg)#
							BASE_ALB = 4,	// Baseline albumin at treatment initiation#
							ADA = 0,	// Anti-drug antibodies (0 = No, 1 = Yes)#
							target = 3	// Target trough concentration (mg/L)#
		$OMEGA		name = "BSV"#
							block = FALSE#
							labels = s(PPVCL,PPVV1,PPVQ,PPVV2)#
							0.106929#
							0.0225#
							1.21#
							0.638401#
		$SIGMA		block = FALSE#
							labels = s(ERRPRO)#
							0.175561#
		$MAIN			// Infusion duration#
							D_CENT = 0.08333333;  // 2 hours#
							// Compartment initial conditions#
							CENT_0 = 0;#
							PERI_0 = 0;#
							TUT_0 = 0;#
							ALB_0 = BASE_ALB;#
							// Covariate effects#
							double ADACOV = 1;	// No anti-drug antibodies#
							if (ADA == 1) ADACOV = 1+ADA_CL;		// Anti-drug antibodies#
							// Individual parameter values#
							double CL = POPCL*pow(WT/70,WT_CL)*pow(ALB/4,ALB_CL)*ADACOV*exp(PPVCL);#
							double V1 = POPV1*pow(WT/70,WT_V1)*exp(PPVV1);#
							double Q = POPQ*pow(WT/70,WT_Q)*exp(PPVQ);#
							double V2 = POPV2*pow(WT/70,WT_V2)*exp(PPVV2);#
		$ODE			// Differential equations#
							dxdt_CENT = -Q/V1*CENT +Q/V2*PERI -CL/V1*CENT;#
							dxdt_PERI = Q/V1*CENT -Q/V2*PERI;#
							// Time under target#
							double CP = CENT/V1;	// Plasma concentration of the central compartment#
							dxdt_TUT = 0;#
							if (CP < target) dxdt_TUT = 1;#
							// Proportion of time under target#
							double pTUT = TUT/SOLVERTIME;#
							// Albumin#
							dxdt_ALB = ALB*(pTUT-90);#
		$TABLE		table(IPRE) = CENT/V1;#
							table(DV) = table(IPRE)*exp(ERRPRO);#
		$CAPTURE	WT ADA ALB CL V1 Q V2 PPVCL PPVV1 PPVQ PPVV2#
		'#
		mod <- mcode("popINFLIX",code)#
	TIME.tgrid <- tgrid(0,365,1)#
	ID.list <- 1:1000#
	population.function <- function(ID.list) {#
		ID.number <- ID.list[1]#
		input.conc.data <- data.frame(#
			ID = ID.number,#
			amt = 5*70,#
			evid = 1,#
			cmt = 1,#
			time = c(0,14,42,98,154,210,266,322),#
			rate = -2#
		)#
	}#
	input.conc.data <- ldply(ID.list, population.function)#
	conc.data <- mod %>% data_set(input.conc.data) %>% carry.out(amt) %>% mrgsim(tgrid = TIME.tgrid)#
	conc.data <- as.data.frame(conc.data)#
	summary.data <- ddply(conc.data, .(time), function(conc.data) sumfuncx(conc.data$IPRE))#
	plotobj1 <- NULL#
	plotobj1 <- ggplot(summary.data)#
	plotobj1 <- plotobj1 + geom_line(aes(x = time,y = median),colour = "red")#
	plotobj1 <- plotobj1 + geom_ribbon(aes(x = time,ymin = low,ymax = hi),fill = "red",alpha = 0.3)#
	plotobj1 <- plotobj1 + scale_x_continuous("\nTime (hours)")#
	plotobj1 <- plotobj1 + scale_y_log10("Infliximab Concentration (mg/L)\n",breaks = c(0.001,0.01,0.1,1,10,100,100),labels = c(0.001,0.01,0.1,1,10,100,100))#
	plotobj1
rm(list=ls(all=TRUE))#
	library(deSolve)	#
	library(ggplot2)	#
	library(plyr)	#
	library(grid)	#
	library(compiler)	#
	library(mrgsolve)	#
	setwd("/Volumes/Prosecutor/PhD/InfliximabBayes/infliximab-bayes/")#
	theme_bw2 <- theme_set(theme_bw(base_size = 16))#
	sumfuncx <- function(x) {#
		stat1 <- median(x)#
		stat2 <- quantile(x,probs = 0.025,names = F)#
		stat3 <- quantile(x,probs = 0.975,names = F)#
		stat4 <- length(x)#
		result <- c("median" = stat1,"low" = stat2,"hi" = stat3,"n" = stat4)#
		result#
	}#
	set.seed(123456)#
		code <- '#
		$CMT			// Specify compartments#
							CENT,	// Central#
							PERI, // Peripheral#
							TUT,	// Time below target compartment#
							ALB	// Albumin, U/L#
		$PARAM		// Population parameters#
							POPCL = 0.294,#
							POPV1 = 3.33,#
							POPQ = 0.0719,#
							POPV2 = 1.14,#
							// Covariate effects#
							WT_CL = 0.614,	// Effect of weight on clearance#
							WT_V1 = 0.691,	// Effect of weight on V1#
							WT_Q = 1.1,	// Effect of weight on Q#
							WT_V2 = 0.59,	// Effect of weight on V2#
							ALB_CL = -1.17,	// Effect of albumin on clearance#
							ADA_CL = 0.257,	// Effect of anti-drug antibodies on clearance#
							// Covariate values for simulation#
							WT = 70,	// Weight (kg)#
							BASE_ALB = 4,	// Baseline albumin at treatment initiation#
							ADA = 0,	// Anti-drug antibodies (0 = No, 1 = Yes)#
							target = 3	// Target trough concentration (mg/L)#
		$OMEGA		name = "BSV"#
							block = FALSE#
							labels = s(PPVCL,PPVV1,PPVQ,PPVV2)#
							0.106929#
							0.0225#
							1.21#
							0.638401#
		$SIGMA		block = FALSE#
							labels = s(ERRPRO)#
							0.175561#
		$MAIN			// Infusion duration#
							D_CENT = 0.08333333;  // 2 hours#
							// Compartment initial conditions#
							CENT_0 = 0;#
							PERI_0 = 0;#
							TUT_0 = 0;#
							ALB_0 = BASE_ALB;#
							// Covariate effects#
							double ADACOV = 1;	// No anti-drug antibodies#
							if (ADA == 1) ADACOV = 1+ADA_CL;		// Anti-drug antibodies#
							// Individual parameter values#
							double CL = POPCL*pow(WT/70,WT_CL)*pow(ALB/4,ALB_CL)*ADACOV*exp(PPVCL);#
							double V1 = POPV1*pow(WT/70,WT_V1)*exp(PPVV1);#
							double Q = POPQ*pow(WT/70,WT_Q)*exp(PPVQ);#
							double V2 = POPV2*pow(WT/70,WT_V2)*exp(PPVV2);#
		$ODE			// Differential equations#
							dxdt_CENT = -Q/V1*CENT +Q/V2*PERI -CL/V1*CENT;#
							dxdt_PERI = Q/V1*CENT -Q/V2*PERI;#
							// Time under target#
							double CP = CENT/V1;	// Plasma concentration of the central compartment#
							dxdt_TUT = 0;#
							if (CP < target) dxdt_TUT = 1;#
							// Proportion of time under target#
							double pTUT = TUT/SOLVERTIME;#
							// Albumin#
							dxdt_ALB = ALB*(pTUT-90);#
		$TABLE		table(IPRE) = CENT/V1;#
							table(DV) = table(IPRE)*exp(ERRPRO);#
		$CAPTURE	WT ADA ALB CL V1 Q V2 PPVCL PPVV1 PPVQ PPVV2 pTUT#
		'#
		mod <- mcode("popINFLIX",code)#
	TIME.tgrid <- tgrid(0,365,1)#
	ID.list <- 1:1000#
	population.function <- function(ID.list) {#
		ID.number <- ID.list[1]#
		input.conc.data <- data.frame(#
			ID = ID.number,#
			amt = 5*70,#
			evid = 1,#
			cmt = 1,#
			time = c(0,14,42,98,154,210,266,322),#
			rate = -2#
		)#
	}#
	input.conc.data <- ldply(ID.list, population.function)#
	conc.data <- mod %>% data_set(input.conc.data) %>% carry.out(amt) %>% mrgsim(tgrid = TIME.tgrid)#
	conc.data <- as.data.frame(conc.data)#
	summary.data <- ddply(conc.data, .(time), function(conc.data) sumfuncx(conc.data$IPRE))#
	plotobj1 <- NULL#
	plotobj1 <- ggplot(summary.data)#
	plotobj1 <- plotobj1 + geom_line(aes(x = time,y = median),colour = "red")#
	plotobj1 <- plotobj1 + geom_ribbon(aes(x = time,ymin = low,ymax = hi),fill = "red",alpha = 0.3)#
	plotobj1 <- plotobj1 + scale_x_continuous("\nTime (hours)")#
	plotobj1 <- plotobj1 + scale_y_log10("Infliximab Concentration (mg/L)\n",breaks = c(0.001,0.01,0.1,1,10,100,100),labels = c(0.001,0.01,0.1,1,10,100,100))#
	plotobj1
rm(list=ls(all=TRUE))#
	library(deSolve)	#
	library(ggplot2)	#
	library(plyr)	#
	library(grid)	#
	library(compiler)	#
	library(mrgsolve)	#
	setwd("/Volumes/Prosecutor/PhD/InfliximabBayes/infliximab-bayes/")#
	theme_bw2 <- theme_set(theme_bw(base_size = 16))#
	sumfuncx <- function(x) {#
		stat1 <- median(x)#
		stat2 <- quantile(x,probs = 0.025,names = F)#
		stat3 <- quantile(x,probs = 0.975,names = F)#
		stat4 <- length(x)#
		result <- c("median" = stat1,"low" = stat2,"hi" = stat3,"n" = stat4)#
		result#
	}#
	set.seed(123456)#
		code <- '#
		$CMT			// Specify compartments#
							CENT,	// Central#
							PERI, // Peripheral#
							TUT,	// Time below target compartment#
							ALB	// Albumin, U/L#
		$PARAM		// Population parameters#
							POPCL = 0.294,#
							POPV1 = 3.33,#
							POPQ = 0.0719,#
							POPV2 = 1.14,#
							// Covariate effects#
							WT_CL = 0.614,	// Effect of weight on clearance#
							WT_V1 = 0.691,	// Effect of weight on V1#
							WT_Q = 1.1,	// Effect of weight on Q#
							WT_V2 = 0.59,	// Effect of weight on V2#
							ALB_CL = -1.17,	// Effect of albumin on clearance#
							ADA_CL = 0.257,	// Effect of anti-drug antibodies on clearance#
							// Covariate values for simulation#
							WT = 70,	// Weight (kg)#
							BASE_ALB = 4,	// Baseline albumin at treatment initiation#
							ADA = 0,	// Anti-drug antibodies (0 = No, 1 = Yes)#
							target = 3	// Target trough concentration (mg/L)#
		$OMEGA		name = "BSV"#
							block = FALSE#
							labels = s(PPVCL,PPVV1,PPVQ,PPVV2)#
							0.106929#
							0.0225#
							1.21#
							0.638401#
		$SIGMA		block = FALSE#
							labels = s(ERRPRO)#
							0.175561#
		$MAIN			// Infusion duration#
							D_CENT = 0.08333333;  // 2 hours#
							// Compartment initial conditions#
							CENT_0 = 0;#
							PERI_0 = 0;#
							TUT_0 = 0;#
							ALB_0 = BASE_ALB;#
							// Covariate effects#
							double ADACOV = 1;	// No anti-drug antibodies#
							if (ADA == 1) ADACOV = 1+ADA_CL;		// Anti-drug antibodies#
							// Individual parameter values#
							double CL = POPCL*pow(WT/70,WT_CL)*pow(ALB/4,ALB_CL)*ADACOV*exp(PPVCL);#
							double V1 = POPV1*pow(WT/70,WT_V1)*exp(PPVV1);#
							double Q = POPQ*pow(WT/70,WT_Q)*exp(PPVQ);#
							double V2 = POPV2*pow(WT/70,WT_V2)*exp(PPVV2);#
		$ODE			// Differential equations#
							dxdt_CENT = -Q/V1*CENT +Q/V2*PERI -CL/V1*CENT;#
							dxdt_PERI = Q/V1*CENT -Q/V2*PERI;#
							// Time under target#
							double CP = CENT/V1;	// Plasma concentration of the central compartment#
							dxdt_TUT = 0;#
							if (CP < target) dxdt_TUT = 1;#
							// Proportion of time under target#
							double pTUT = 0;#
							if (SOLVERTIME > 0.08333333) pTUT = TUT/SOLVERTIME;#
							// Albumin#
							dxdt_ALB = ALB*(pTUT-90);#
		$TABLE		table(IPRE) = CENT/V1;#
							table(DV) = table(IPRE)*exp(ERRPRO);#
		$CAPTURE	WT ADA ALB CL V1 Q V2 PPVCL PPVV1 PPVQ PPVV2 pTUT#
		'#
		mod <- mcode("popINFLIX",code)#
	TIME.tgrid <- tgrid(0,365,1)#
	ID.list <- 1:1000#
	population.function <- function(ID.list) {#
		ID.number <- ID.list[1]#
		input.conc.data <- data.frame(#
			ID = ID.number,#
			amt = 5*70,#
			evid = 1,#
			cmt = 1,#
			time = c(0,14,42,98,154,210,266,322),#
			rate = -2#
		)#
	}#
	input.conc.data <- ldply(ID.list, population.function)#
	conc.data <- mod %>% data_set(input.conc.data) %>% carry.out(amt) %>% mrgsim(tgrid = TIME.tgrid)#
	conc.data <- as.data.frame(conc.data)#
	summary.data <- ddply(conc.data, .(time), function(conc.data) sumfuncx(conc.data$IPRE))#
	plotobj1 <- NULL#
	plotobj1 <- ggplot(summary.data)#
	plotobj1 <- plotobj1 + geom_line(aes(x = time,y = median),colour = "red")#
	plotobj1 <- plotobj1 + geom_ribbon(aes(x = time,ymin = low,ymax = hi),fill = "red",alpha = 0.3)#
	plotobj1 <- plotobj1 + scale_x_continuous("\nTime (hours)")#
	plotobj1 <- plotobj1 + scale_y_log10("Infliximab Concentration (mg/L)\n",breaks = c(0.001,0.01,0.1,1,10,100,100),labels = c(0.001,0.01,0.1,1,10,100,100))#
	plotobj1
rm(list=ls(all=TRUE))#
	library(deSolve)	#
	library(ggplot2)	#
	library(plyr)	#
	library(grid)	#
	library(compiler)	#
	library(mrgsolve)	#
	setwd("/Volumes/Prosecutor/PhD/InfliximabBayes/infliximab-bayes/")#
	theme_bw2 <- theme_set(theme_bw(base_size = 16))#
	sumfuncx <- function(x) {#
		stat1 <- median(x)#
		stat2 <- quantile(x,probs = 0.025,names = F)#
		stat3 <- quantile(x,probs = 0.975,names = F)#
		stat4 <- length(x)#
		result <- c("median" = stat1,"low" = stat2,"hi" = stat3,"n" = stat4)#
		result#
	}#
	set.seed(123456)#
		code <- '#
		$CMT			// Specify compartments#
							CENT,	// Central#
							PERI, // Peripheral#
							TUT,	// Time below target compartment#
							ALB	// Albumin, U/L#
		$PARAM		// Population parameters#
							POPCL = 0.294,#
							POPV1 = 3.33,#
							POPQ = 0.0719,#
							POPV2 = 1.14,#
							// Covariate effects#
							WT_CL = 0.614,	// Effect of weight on clearance#
							WT_V1 = 0.691,	// Effect of weight on V1#
							WT_Q = 1.1,	// Effect of weight on Q#
							WT_V2 = 0.59,	// Effect of weight on V2#
							ALB_CL = -1.17,	// Effect of albumin on clearance#
							ADA_CL = 0.257,	// Effect of anti-drug antibodies on clearance#
							// Covariate values for simulation#
							WT = 70,	// Weight (kg)#
							BASE_ALB = 4,	// Baseline albumin at treatment initiation#
							ADA = 0,	// Anti-drug antibodies (0 = No, 1 = Yes)#
							target = 3	// Target trough concentration (mg/L)#
		$OMEGA		name = "BSV"#
							block = FALSE#
							labels = s(PPVCL,PPVV1,PPVQ,PPVV2)#
							0.106929#
							0.0225#
							1.21#
							0.638401#
		$SIGMA		block = FALSE#
							labels = s(ERRPRO)#
							0.175561#
		$MAIN			// Infusion duration#
							D_CENT = 0.08333333;  // 2 hours#
							// Compartment initial conditions#
							CENT_0 = 0;#
							PERI_0 = 0;#
							TUT_0 = 0;#
							ALB_0 = BASE_ALB;#
							// Covariate effects#
							double ADACOV = 1;	// No anti-drug antibodies#
							if (ADA == 1) ADACOV = 1+ADA_CL;		// Anti-drug antibodies#
							// Individual parameter values#
							double CL = POPCL*pow(WT/70,WT_CL)*pow(ALB/4,ALB_CL)*ADACOV*exp(PPVCL);#
							double V1 = POPV1*pow(WT/70,WT_V1)*exp(PPVV1);#
							double Q = POPQ*pow(WT/70,WT_Q)*exp(PPVQ);#
							double V2 = POPV2*pow(WT/70,WT_V2)*exp(PPVV2);#
		$ODE			// Differential equations#
							dxdt_CENT = -Q/V1*CENT +Q/V2*PERI -CL/V1*CENT;#
							dxdt_PERI = Q/V1*CENT -Q/V2*PERI;#
							// Time under target#
							double CP = CENT/V1;	// Plasma concentration of the central compartment#
							dxdt_TUT = 0;#
							if (CP < target) dxdt_TUT = 1;#
							// Proportion of time under target#
							double pTUT = 0;#
							if (SOLVERTIME > 0.08333333) pTUT = TUT/SOLVERTIME;#
							// Albumin#
							dxdt_ALB = ALB*(pTUT-0.9);#
		$TABLE		table(IPRE) = CENT/V1;#
							table(DV) = table(IPRE)*exp(ERRPRO);#
		$CAPTURE	WT ADA ALB CL V1 Q V2 PPVCL PPVV1 PPVQ PPVV2 pTUT#
		'#
		mod <- mcode("popINFLIX",code)#
	TIME.tgrid <- tgrid(0,365,1)#
	ID.list <- 1:1000#
	population.function <- function(ID.list) {#
		ID.number <- ID.list[1]#
		input.conc.data <- data.frame(#
			ID = ID.number,#
			amt = 5*70,#
			evid = 1,#
			cmt = 1,#
			time = c(0,14,42,98,154,210,266,322),#
			rate = -2#
		)#
	}#
	input.conc.data <- ldply(ID.list, population.function)#
	conc.data <- mod %>% data_set(input.conc.data) %>% carry.out(amt) %>% mrgsim(tgrid = TIME.tgrid)#
	conc.data <- as.data.frame(conc.data)#
	summary.data <- ddply(conc.data, .(time), function(conc.data) sumfuncx(conc.data$IPRE))#
	plotobj1 <- NULL#
	plotobj1 <- ggplot(summary.data)#
	plotobj1 <- plotobj1 + geom_line(aes(x = time,y = median),colour = "red")#
	plotobj1 <- plotobj1 + geom_ribbon(aes(x = time,ymin = low,ymax = hi),fill = "red",alpha = 0.3)#
	plotobj1 <- plotobj1 + scale_x_continuous("\nTime (hours)")#
	plotobj1 <- plotobj1 + scale_y_log10("Infliximab Concentration (mg/L)\n",breaks = c(0.001,0.01,0.1,1,10,100,100),labels = c(0.001,0.01,0.1,1,10,100,100))#
	plotobj1
TIME.tgrid <- tgrid(0,365,1)#
	ID.list <- 1:1000#
	population.function <- function(ID.list) {#
		ID.number <- ID.list[1]#
		input.conc.data <- data.frame(#
			ID = 1,#
			amt = 5*70,#
			evid = 1,#
			cmt = 1,#
			time = c(0,14,42,98,154,210,266,322),#
			rate = -2#
		)#
	}#
	input.conc.data <- ldply(ID.list, population.function)
head(input.conc.data)
input.conc.data <- data.frame(#
			ID = 1,#
			amt = 5*70,#
			evid = 1,#
			cmt = 1,#
			time = c(0,14,42,98,154,210,266,322),#
			rate = -2#
		)
conc.data <- mod %>% data_set(input.conc.data) %>% carry.out(amt) %>% mrgsim(tgrid = TIME.tgrid)#
	conc.data <- as.data.frame(conc.data)
conc.data
plotobj2 <- NULL#
	plotobj2 <- ggplot(conc.data)#
	plotobj2 <- plotobj2 + geom_line(aes(x = time,y = IPRE),colour = "blue")#
	plotobj2 <- plotobj2 + scale_x_continuous("\nTime (hours)")#
	plotobj2 <- plotobj2 + scale_y_log10("Infliximab Concentration (mg/L)\n",breaks = c(0.001,0.01,0.1,1,10,100,100),labels = c(0.001,0.01,0.1,1,10,100,100))#
	plotobj2
rm(list=ls(all=TRUE))#
	library(deSolve)	#
	library(ggplot2)	#
	library(plyr)	#
	library(grid)	#
	library(compiler)	#
	library(mrgsolve)	#
	setwd("/Volumes/Prosecutor/PhD/InfliximabBayes/infliximab-bayes/")#
	theme_bw2 <- theme_set(theme_bw(base_size = 16))#
	sumfuncx <- function(x) {#
		stat1 <- median(x)#
		stat2 <- quantile(x,probs = 0.025,names = F)#
		stat3 <- quantile(x,probs = 0.975,names = F)#
		stat4 <- length(x)#
		result <- c("median" = stat1,"low" = stat2,"hi" = stat3,"n" = stat4)#
		result#
	}#
	set.seed(123456)#
		code <- '#
		$CMT			// Specify compartments#
							CENT,	// Central#
							PERI, // Peripheral#
							TUT,	// Time below target compartment#
							ALB	// Albumin, U/L#
		$PARAM		// Population parameters#
							POPCL = 0.294,#
							POPV1 = 3.33,#
							POPQ = 0.0719,#
							POPV2 = 1.14,#
							// Covariate effects#
							WT_CL = 0.614,	// Effect of weight on clearance#
							WT_V1 = 0.691,	// Effect of weight on V1#
							WT_Q = 1.1,	// Effect of weight on Q#
							WT_V2 = 0.59,	// Effect of weight on V2#
							ALB_CL = -1.17,	// Effect of albumin on clearance#
							ADA_CL = 0.257,	// Effect of anti-drug antibodies on clearance#
							// Covariate values for simulation#
							WT = 70,	// Weight (kg)#
							BASE_ALB = 4,	// Baseline albumin at treatment initiation#
							ADA = 0,	// Anti-drug antibodies (0 = No, 1 = Yes)#
							target = 3	// Target trough concentration (mg/L)#
		$OMEGA		name = "BSV"#
							block = FALSE#
							labels = s(PPVCL,PPVV1,PPVQ,PPVV2)#
							0.106929#
							0.0225#
							1.21#
							0.638401#
		$SIGMA		block = FALSE#
							labels = s(ERRPRO)#
							0.175561#
		$MAIN			// Infusion duration#
							D_CENT = 0.08333333;  // 2 hours#
							// Compartment initial conditions#
							CENT_0 = 0;#
							PERI_0 = 0;#
							TUT_0 = 0;#
							ALB_0 = BASE_ALB;#
							// Covariate effects#
							double ADACOV = 1;	// No anti-drug antibodies#
							if (ADA == 1) ADACOV = 1+ADA_CL;		// Anti-drug antibodies#
							// Individual parameter values#
							double CL = POPCL*pow(WT/70,WT_CL)*pow(ALB/4,ALB_CL)*ADACOV*exp(PPVCL);#
							double V1 = POPV1*pow(WT/70,WT_V1)*exp(PPVV1);#
							double Q = POPQ*pow(WT/70,WT_Q)*exp(PPVQ);#
							double V2 = POPV2*pow(WT/70,WT_V2)*exp(PPVV2);#
		$ODE			// Differential equations#
							dxdt_CENT = -Q/V1*CENT +Q/V2*PERI -CL/V1*CENT;#
							dxdt_PERI = Q/V1*CENT -Q/V2*PERI;#
							// Time under target#
							double CP = CENT/V1;	// Plasma concentration of the central compartment#
							dxdt_TUT = 0;#
							if (CP < target) dxdt_TUT = 1;#
							// Proportion of time under target#
							double pTUT = 0;#
							if (SOLVERTIME > 0.08333333) pTUT = TUT/SOLVERTIME;#
							// Albumin#
							dxdt_ALB = ALB*(0.9-pTUT);#
		$TABLE		table(IPRE) = CENT/V1;#
							table(DV) = table(IPRE)*exp(ERRPRO);#
		$CAPTURE	WT ADA ALB CL V1 Q V2 PPVCL PPVV1 PPVQ PPVV2 pTUT#
		'#
		mod <- mcode("popINFLIX",code)#
	TIME.tgrid <- tgrid(0,365,1)#
	ID.list <- 1:1000#
		input.conc.data <- data.frame(#
			ID = 1,#
			amt = 5*70,#
			evid = 1,#
			cmt = 1,#
			time = c(0,14,42,98,154,210,266,322),#
			rate = -2#
		)#
	}#
	conc.data <- mod %>% data_set(input.conc.data) %>% carry.out(amt) %>% mrgsim(tgrid = TIME.tgrid)#
	conc.data <- as.data.frame(conc.data)#
	plotobj2 <- NULL#
	plotobj2 <- ggplot(conc.data)#
	plotobj2 <- plotobj2 + geom_line(aes(x = time,y = IPRE),colour = "blue")#
	plotobj2 <- plotobj2 + scale_x_continuous("\nTime (hours)")#
	plotobj2 <- plotobj2 + scale_y_log10("Infliximab Concentration (mg/L)\n",breaks = c(0.001,0.01,0.1,1,10,100,100),labels = c(0.001,0.01,0.1,1,10,100,100))#
	plotobj2
rm(list=ls(all=TRUE))#
	library(deSolve)	#
	library(ggplot2)	#
	library(plyr)	#
	library(grid)	#
	library(compiler)	#
	library(mrgsolve)	#
	setwd("/Volumes/Prosecutor/PhD/InfliximabBayes/infliximab-bayes/")#
	theme_bw2 <- theme_set(theme_bw(base_size = 16))#
	sumfuncx <- function(x) {#
		stat1 <- median(x)#
		stat2 <- quantile(x,probs = 0.025,names = F)#
		stat3 <- quantile(x,probs = 0.975,names = F)#
		stat4 <- length(x)#
		result <- c("median" = stat1,"low" = stat2,"hi" = stat3,"n" = stat4)#
		result#
	}#
	set.seed(123456)#
		code <- '#
		$CMT			// Specify compartments#
							CENT,	// Central#
							PERI, // Peripheral#
							TUT,	// Time below target compartment#
							ALB	// Albumin, U/L#
		$PARAM		// Population parameters#
							POPCL = 0.294,#
							POPV1 = 3.33,#
							POPQ = 0.0719,#
							POPV2 = 1.14,#
							// Covariate effects#
							WT_CL = 0.614,	// Effect of weight on clearance#
							WT_V1 = 0.691,	// Effect of weight on V1#
							WT_Q = 1.1,	// Effect of weight on Q#
							WT_V2 = 0.59,	// Effect of weight on V2#
							ALB_CL = -1.17,	// Effect of albumin on clearance#
							ADA_CL = 0.257,	// Effect of anti-drug antibodies on clearance#
							// Covariate values for simulation#
							WT = 70,	// Weight (kg)#
							BASE_ALB = 4,	// Baseline albumin at treatment initiation#
							ADA = 0,	// Anti-drug antibodies (0 = No, 1 = Yes)#
							target = 3	// Target trough concentration (mg/L)#
		$OMEGA		name = "BSV"#
							block = FALSE#
							labels = s(PPVCL,PPVV1,PPVQ,PPVV2)#
							0.106929#
							0.0225#
							1.21#
							0.638401#
		$SIGMA		block = FALSE#
							labels = s(ERRPRO)#
							0.175561#
		$MAIN			// Infusion duration#
							D_CENT = 0.08333333;  // 2 hours#
							// Compartment initial conditions#
							CENT_0 = 0;#
							PERI_0 = 0;#
							TUT_0 = 0;#
							ALB_0 = BASE_ALB;#
							// Covariate effects#
							double ADACOV = 1;	// No anti-drug antibodies#
							if (ADA == 1) ADACOV = 1+ADA_CL;		// Anti-drug antibodies#
							// Individual parameter values#
							double CL = POPCL*pow(WT/70,WT_CL)*pow(ALB/4,ALB_CL)*ADACOV*exp(PPVCL);#
							double V1 = POPV1*pow(WT/70,WT_V1)*exp(PPVV1);#
							double Q = POPQ*pow(WT/70,WT_Q)*exp(PPVQ);#
							double V2 = POPV2*pow(WT/70,WT_V2)*exp(PPVV2);#
		$ODE			// Differential equations#
							dxdt_CENT = -Q/V1*CENT +Q/V2*PERI -CL/V1*CENT;#
							dxdt_PERI = Q/V1*CENT -Q/V2*PERI;#
							// Time under target#
							double CP = CENT/V1;	// Plasma concentration of the central compartment#
							dxdt_TUT = 0;#
							if (CP < target) dxdt_TUT = 1;#
							// Proportion of time under target#
							double pTUT = 0;#
							if (SOLVERTIME > 0.08333333) pTUT = TUT/SOLVERTIME;#
							// Albumin#
							dxdt_ALB = ALB*(0.9-pTUT);#
		$TABLE		table(IPRE) = CENT/V1;#
							table(DV) = table(IPRE)*exp(ERRPRO);#
		$CAPTURE	WT ADA ALB CL V1 Q V2 PPVCL PPVV1 PPVQ PPVV2 pTUT#
		'#
		mod <- mcode("popINFLIX",code)#
	TIME.tgrid <- tgrid(0,365,1)#
	ID.list <- 1:1000#
		input.conc.data <- data.frame(#
			ID = 1,#
			amt = 5*70,#
			evid = 1,#
			cmt = 1,#
			time = c(0,14,42,98,154,210,266,322),#
			rate = -2#
		)#
	conc.data <- mod %>% data_set(input.conc.data) %>% carry.out(amt) %>% mrgsim(tgrid = TIME.tgrid)#
	conc.data <- as.data.frame(conc.data)#
	plotobj2 <- NULL#
	plotobj2 <- ggplot(conc.data)#
	plotobj2 <- plotobj2 + geom_line(aes(x = time,y = IPRE),colour = "blue")#
	plotobj2 <- plotobj2 + scale_x_continuous("\nTime (hours)")#
	plotobj2 <- plotobj2 + scale_y_log10("Infliximab Concentration (mg/L)\n",breaks = c(0.001,0.01,0.1,1,10,100,100),labels = c(0.001,0.01,0.1,1,10,100,100))#
	plotobj2
rm(list=ls(all=TRUE))#
	library(deSolve)	#
	library(ggplot2)	#
	library(plyr)	#
	library(grid)	#
	library(compiler)	#
	library(mrgsolve)	#
	setwd("/Volumes/Prosecutor/PhD/InfliximabBayes/infliximab-bayes/")#
	theme_bw2 <- theme_set(theme_bw(base_size = 16))#
	sumfuncx <- function(x) {#
		stat1 <- median(x)#
		stat2 <- quantile(x,probs = 0.025,names = F)#
		stat3 <- quantile(x,probs = 0.975,names = F)#
		stat4 <- length(x)#
		result <- c("median" = stat1,"low" = stat2,"hi" = stat3,"n" = stat4)#
		result#
	}#
	set.seed(123456)#
		code <- '#
		$CMT			// Specify compartments#
							CENT,	// Central#
							PERI, // Peripheral#
							TUT,	// Time below target compartment#
							ALB	// Albumin, U/L#
		$PARAM		// Population parameters#
							POPCL = 0.294,#
							POPV1 = 3.33,#
							POPQ = 0.0719,#
							POPV2 = 1.14,#
							// Covariate effects#
							WT_CL = 0.614,	// Effect of weight on clearance#
							WT_V1 = 0.691,	// Effect of weight on V1#
							WT_Q = 1.1,	// Effect of weight on Q#
							WT_V2 = 0.59,	// Effect of weight on V2#
							ALB_CL = -1.17,	// Effect of albumin on clearance#
							ADA_CL = 0.257,	// Effect of anti-drug antibodies on clearance#
							// Covariate values for simulation#
							WT = 70,	// Weight (kg)#
							BASE_ALB = 4,	// Baseline albumin at treatment initiation#
							ADA = 0,	// Anti-drug antibodies (0 = No, 1 = Yes)#
							target = 3	// Target trough concentration (mg/L)#
		$OMEGA		name = "BSV"#
							block = FALSE#
							labels = s(PPVCL,PPVV1,PPVQ,PPVV2)#
							0.106929#
							0.0225#
							1.21#
							0.638401#
		$SIGMA		block = FALSE#
							labels = s(ERRPRO)#
							0.175561#
		$MAIN			// Infusion duration#
							D_CENT = 0.08333333;  // 2 hours#
							// Compartment initial conditions#
							CENT_0 = 0;#
							PERI_0 = 0;#
							TUT_0 = 0;#
							ALB_0 = BASE_ALB;#
							// Covariate effects#
							double ADACOV = 1;	// No anti-drug antibodies#
							if (ADA == 1) ADACOV = 1+ADA_CL;		// Anti-drug antibodies#
							// Individual parameter values#
							double CL = POPCL*pow(WT/70,WT_CL)*pow(ALB/4,ALB_CL)*ADACOV*exp(PPVCL);#
							double V1 = POPV1*pow(WT/70,WT_V1)*exp(PPVV1);#
							double Q = POPQ*pow(WT/70,WT_Q)*exp(PPVQ);#
							double V2 = POPV2*pow(WT/70,WT_V2)*exp(PPVV2);#
		$ODE			// Differential equations#
							dxdt_CENT = -Q/V1*CENT +Q/V2*PERI -CL/V1*CENT;#
							dxdt_PERI = Q/V1*CENT -Q/V2*PERI;#
							// Time under target#
							double CP = CENT/V1;	// Plasma concentration of the central compartment#
							dxdt_TUT = 0;#
							if (CP < target) dxdt_TUT = 1;#
							// Proportion of time under target#
							double pTUT = 0;#
							if (SOLVERTIME > 0.08333333) pTUT = TUT/SOLVERTIME;#
							// Albumin#
							dxdt_ALB = ALB*((0.9-pTUT)/100;#
		$TABLE		table(IPRE) = CENT/V1;#
							table(DV) = table(IPRE)*exp(ERRPRO);#
		$CAPTURE	WT ADA ALB CL V1 Q V2 PPVCL PPVV1 PPVQ PPVV2 pTUT#
		'#
		mod <- mcode("popINFLIX",code)#
	TIME.tgrid <- tgrid(0,365,1)#
	ID.list <- 1:1000#
		input.conc.data <- data.frame(#
			ID = 1,#
			amt = 5*70,#
			evid = 1,#
			cmt = 1,#
			time = c(0,14,42,98,154,210,266,322),#
			rate = -2#
		)#
	conc.data <- mod %>% data_set(input.conc.data) %>% carry.out(amt) %>% mrgsim(tgrid = TIME.tgrid)#
	conc.data <- as.data.frame(conc.data)#
	plotobj2 <- NULL#
	plotobj2 <- ggplot(conc.data)#
	plotobj2 <- plotobj2 + geom_line(aes(x = time,y = IPRE),colour = "blue")#
	plotobj2 <- plotobj2 + scale_x_continuous("\nTime (hours)")#
	plotobj2 <- plotobj2 + scale_y_log10("Infliximab Concentration (mg/L)\n",breaks = c(0.001,0.01,0.1,1,10,100,100),labels = c(0.001,0.01,0.1,1,10,100,100))#
	plotobj2
rm(list=ls(all=TRUE))#
	library(deSolve)	#
	library(ggplot2)	#
	library(plyr)	#
	library(grid)	#
	library(compiler)	#
	library(mrgsolve)	#
	setwd("/Volumes/Prosecutor/PhD/InfliximabBayes/infliximab-bayes/")#
	theme_bw2 <- theme_set(theme_bw(base_size = 16))#
	sumfuncx <- function(x) {#
		stat1 <- median(x)#
		stat2 <- quantile(x,probs = 0.025,names = F)#
		stat3 <- quantile(x,probs = 0.975,names = F)#
		stat4 <- length(x)#
		result <- c("median" = stat1,"low" = stat2,"hi" = stat3,"n" = stat4)#
		result#
	}#
	set.seed(123456)#
		code <- '#
		$CMT			// Specify compartments#
							CENT,	// Central#
							PERI, // Peripheral#
							TUT,	// Time below target compartment#
							ALB	// Albumin, U/L#
		$PARAM		// Population parameters#
							POPCL = 0.294,#
							POPV1 = 3.33,#
							POPQ = 0.0719,#
							POPV2 = 1.14,#
							// Covariate effects#
							WT_CL = 0.614,	// Effect of weight on clearance#
							WT_V1 = 0.691,	// Effect of weight on V1#
							WT_Q = 1.1,	// Effect of weight on Q#
							WT_V2 = 0.59,	// Effect of weight on V2#
							ALB_CL = -1.17,	// Effect of albumin on clearance#
							ADA_CL = 0.257,	// Effect of anti-drug antibodies on clearance#
							// Covariate values for simulation#
							WT = 70,	// Weight (kg)#
							BASE_ALB = 4,	// Baseline albumin at treatment initiation#
							ADA = 0,	// Anti-drug antibodies (0 = No, 1 = Yes)#
							target = 3	// Target trough concentration (mg/L)#
		$OMEGA		name = "BSV"#
							block = FALSE#
							labels = s(PPVCL,PPVV1,PPVQ,PPVV2)#
							0.106929#
							0.0225#
							1.21#
							0.638401#
		$SIGMA		block = FALSE#
							labels = s(ERRPRO)#
							0.175561#
		$MAIN			// Infusion duration#
							D_CENT = 0.08333333;  // 2 hours#
							// Compartment initial conditions#
							CENT_0 = 0;#
							PERI_0 = 0;#
							TUT_0 = 0;#
							ALB_0 = BASE_ALB;#
							// Covariate effects#
							double ADACOV = 1;	// No anti-drug antibodies#
							if (ADA == 1) ADACOV = 1+ADA_CL;		// Anti-drug antibodies#
							// Individual parameter values#
							double CL = POPCL*pow(WT/70,WT_CL)*pow(ALB/4,ALB_CL)*ADACOV*exp(PPVCL);#
							double V1 = POPV1*pow(WT/70,WT_V1)*exp(PPVV1);#
							double Q = POPQ*pow(WT/70,WT_Q)*exp(PPVQ);#
							double V2 = POPV2*pow(WT/70,WT_V2)*exp(PPVV2);#
		$ODE			// Differential equations#
							dxdt_CENT = -Q/V1*CENT +Q/V2*PERI -CL/V1*CENT;#
							dxdt_PERI = Q/V1*CENT -Q/V2*PERI;#
							// Time under target#
							double CP = CENT/V1;	// Plasma concentration of the central compartment#
							dxdt_TUT = 0;#
							if (CP < target) dxdt_TUT = 1;#
							// Proportion of time under target#
							double pTUT = 0;#
							if (SOLVERTIME > 0.08333333) pTUT = TUT/SOLVERTIME;#
							// Albumin#
							dxdt_ALB = ALB*((0.9-pTUT)/100);#
		$TABLE		table(IPRE) = CENT/V1;#
							table(DV) = table(IPRE)*exp(ERRPRO);#
		$CAPTURE	WT ADA ALB CL V1 Q V2 PPVCL PPVV1 PPVQ PPVV2 pTUT#
		'#
		mod <- mcode("popINFLIX",code)#
	TIME.tgrid <- tgrid(0,365,1)#
	ID.list <- 1:1000#
		input.conc.data <- data.frame(#
			ID = 1,#
			amt = 5*70,#
			evid = 1,#
			cmt = 1,#
			time = c(0,14,42,98,154,210,266,322),#
			rate = -2#
		)#
	conc.data <- mod %>% data_set(input.conc.data) %>% carry.out(amt) %>% mrgsim(tgrid = TIME.tgrid)#
	conc.data <- as.data.frame(conc.data)#
	plotobj2 <- NULL#
	plotobj2 <- ggplot(conc.data)#
	plotobj2 <- plotobj2 + geom_line(aes(x = time,y = IPRE),colour = "blue")#
	plotobj2 <- plotobj2 + scale_x_continuous("\nTime (hours)")#
	plotobj2 <- plotobj2 + scale_y_log10("Infliximab Concentration (mg/L)\n",breaks = c(0.001,0.01,0.1,1,10,100,100),labels = c(0.001,0.01,0.1,1,10,100,100))#
	plotobj2
rm(list=ls(all=TRUE))#
	library(deSolve)	#
	library(ggplot2)	#
	library(plyr)	#
	library(grid)	#
	library(compiler)	#
	library(mrgsolve)	#
	setwd("/Volumes/Prosecutor/PhD/InfliximabBayes/infliximab-bayes/")#
	theme_bw2 <- theme_set(theme_bw(base_size = 16))#
	sumfuncx <- function(x) {#
		stat1 <- median(x)#
		stat2 <- quantile(x,probs = 0.025,names = F)#
		stat3 <- quantile(x,probs = 0.975,names = F)#
		stat4 <- length(x)#
		result <- c("median" = stat1,"low" = stat2,"hi" = stat3,"n" = stat4)#
		result#
	}#
	set.seed(123456)#
		code <- '#
		$CMT			// Specify compartments#
							CENT,	// Central#
							PERI, // Peripheral#
							TUT,	// Time below target compartment#
							ALB	// Albumin, U/L#
		$PARAM		// Population parameters#
							POPCL = 0.294,#
							POPV1 = 3.33,#
							POPQ = 0.0719,#
							POPV2 = 1.14,#
							// Covariate effects#
							WT_CL = 0.614,	// Effect of weight on clearance#
							WT_V1 = 0.691,	// Effect of weight on V1#
							WT_Q = 1.1,	// Effect of weight on Q#
							WT_V2 = 0.59,	// Effect of weight on V2#
							ALB_CL = -1.17,	// Effect of albumin on clearance#
							ADA_CL = 0.257,	// Effect of anti-drug antibodies on clearance#
							// Covariate values for simulation#
							WT = 70,	// Weight (kg)#
							BASE_ALB = 4,	// Baseline albumin at treatment initiation#
							ADA = 0,	// Anti-drug antibodies (0 = No, 1 = Yes)#
							target = 3	// Target trough concentration (mg/L)#
		$OMEGA		name = "BSV"#
							block = FALSE#
							labels = s(PPVCL,PPVV1,PPVQ,PPVV2)#
							0.106929#
							0.0225#
							1.21#
							0.638401#
		$SIGMA		block = FALSE#
							labels = s(ERRPRO)#
							0.175561#
		$MAIN			// Infusion duration#
							D_CENT = 0.08333333;  // 2 hours#
							// Compartment initial conditions#
							CENT_0 = 0;#
							PERI_0 = 0;#
							TUT_0 = 0;#
							ALB_0 = BASE_ALB;#
							// Covariate effects#
							double ADACOV = 1;	// No anti-drug antibodies#
							if (ADA == 1) ADACOV = 1+ADA_CL;		// Anti-drug antibodies#
							// Individual parameter values#
							double CL = POPCL*pow(WT/70,WT_CL)*pow(ALB/4,ALB_CL)*ADACOV*exp(PPVCL);#
							double V1 = POPV1*pow(WT/70,WT_V1)*exp(PPVV1);#
							double Q = POPQ*pow(WT/70,WT_Q)*exp(PPVQ);#
							double V2 = POPV2*pow(WT/70,WT_V2)*exp(PPVV2);#
		$ODE			// Differential equations#
							dxdt_CENT = -Q/V1*CENT +Q/V2*PERI -CL/V1*CENT;#
							dxdt_PERI = Q/V1*CENT -Q/V2*PERI;#
							// Time under target#
							double CP = CENT/V1;	// Plasma concentration of the central compartment#
							dxdt_TUT = 0;#
							if (CP < target) dxdt_TUT = 1;#
							// Proportion of time under target#
							double pTUT = 0;#
							if (SOLVERTIME > 0.08333333) pTUT = TUT/SOLVERTIME;#
							// Albumin#
							dxdt_ALB = ALB*(pTUT/0.9);#
		$TABLE		table(IPRE) = CENT/V1;#
							table(DV) = table(IPRE)*exp(ERRPRO);#
		$CAPTURE	WT ADA ALB CL V1 Q V2 PPVCL PPVV1 PPVQ PPVV2 pTUT#
		'#
		mod <- mcode("popINFLIX",code)#
	TIME.tgrid <- tgrid(0,365,1)#
	ID.list <- 1:1000#
		input.conc.data <- data.frame(#
			ID = 1,#
			amt = 5*70,#
			evid = 1,#
			cmt = 1,#
			time = c(0,14,42,98,154,210,266,322),#
			rate = -2#
		)#
	conc.data <- mod %>% data_set(input.conc.data) %>% carry.out(amt) %>% mrgsim(tgrid = TIME.tgrid)#
	conc.data <- as.data.frame(conc.data)#
	plotobj2 <- NULL#
	plotobj2 <- ggplot(conc.data)#
	plotobj2 <- plotobj2 + geom_line(aes(x = time,y = IPRE),colour = "blue")#
	plotobj2 <- plotobj2 + scale_x_continuous("\nTime (hours)")#
	plotobj2 <- plotobj2 + scale_y_log10("Infliximab Concentration (mg/L)\n",breaks = c(0.001,0.01,0.1,1,10,100,100),labels = c(0.001,0.01,0.1,1,10,100,100))#
	plotobj2
rm(list=ls(all=TRUE))#
	library(deSolve)	#
	library(ggplot2)	#
	library(plyr)	#
	library(grid)	#
	library(compiler)	#
	library(mrgsolve)	#
	setwd("/Volumes/Prosecutor/PhD/InfliximabBayes/infliximab-bayes/")#
	theme_bw2 <- theme_set(theme_bw(base_size = 16))#
	sumfuncx <- function(x) {#
		stat1 <- median(x)#
		stat2 <- quantile(x,probs = 0.025,names = F)#
		stat3 <- quantile(x,probs = 0.975,names = F)#
		stat4 <- length(x)#
		result <- c("median" = stat1,"low" = stat2,"hi" = stat3,"n" = stat4)#
		result#
	}#
	set.seed(123456)#
		code <- '#
		$CMT			// Specify compartments#
							CENT,	// Central#
							PERI, // Peripheral#
							TUT,	// Time below target compartment#
							ALB	// Albumin, U/L#
		$PARAM		// Population parameters#
							POPCL = 0.294,#
							POPV1 = 3.33,#
							POPQ = 0.0719,#
							POPV2 = 1.14,#
							// Covariate effects#
							WT_CL = 0.614,	// Effect of weight on clearance#
							WT_V1 = 0.691,	// Effect of weight on V1#
							WT_Q = 1.1,	// Effect of weight on Q#
							WT_V2 = 0.59,	// Effect of weight on V2#
							ALB_CL = -1.17,	// Effect of albumin on clearance#
							ADA_CL = 0.257,	// Effect of anti-drug antibodies on clearance#
							// Covariate values for simulation#
							WT = 70,	// Weight (kg)#
							BASE_ALB = 4,	// Baseline albumin at treatment initiation#
							ADA = 0,	// Anti-drug antibodies (0 = No, 1 = Yes)#
							target = 3	// Target trough concentration (mg/L)#
		$OMEGA		name = "BSV"#
							block = FALSE#
							labels = s(PPVCL,PPVV1,PPVQ,PPVV2)#
							0.106929#
							0.0225#
							1.21#
							0.638401#
		$SIGMA		block = FALSE#
							labels = s(ERRPRO)#
							0.175561#
		$MAIN			// Infusion duration#
							D_CENT = 0.08333333;  // 2 hours#
							// Compartment initial conditions#
							CENT_0 = 0;#
							PERI_0 = 0;#
							TUT_0 = 0;#
							ALB_0 = BASE_ALB;#
							// Covariate effects#
							double ADACOV = 1;	// No anti-drug antibodies#
							if (ADA == 1) ADACOV = 1+ADA_CL;		// Anti-drug antibodies#
							// Individual parameter values#
							double CL = POPCL*pow(WT/70,WT_CL)*pow(ALB/4,ALB_CL)*ADACOV*exp(PPVCL);#
							double V1 = POPV1*pow(WT/70,WT_V1)*exp(PPVV1);#
							double Q = POPQ*pow(WT/70,WT_Q)*exp(PPVQ);#
							double V2 = POPV2*pow(WT/70,WT_V2)*exp(PPVV2);#
		$ODE			// Differential equations#
							dxdt_CENT = -Q/V1*CENT +Q/V2*PERI -CL/V1*CENT;#
							dxdt_PERI = Q/V1*CENT -Q/V2*PERI;#
							// Time under target#
							double CP = CENT/V1;	// Plasma concentration of the central compartment#
							dxdt_TUT = 0;#
							if (CP < target) dxdt_TUT = 1;#
							// Proportion of time under target#
							double pTUT = 0;#
							if (SOLVERTIME > 0.08333333) pTUT = TUT/SOLVERTIME;#
							// Albumin#
							dxdt_ALB = ALB*log(pTUT/0.1);#
		$TABLE		table(IPRE) = CENT/V1;#
							table(DV) = table(IPRE)*exp(ERRPRO);#
		$CAPTURE	WT ADA ALB CL V1 Q V2 PPVCL PPVV1 PPVQ PPVV2 pTUT#
		'#
		mod <- mcode("popINFLIX",code)#
	TIME.tgrid <- tgrid(0,365,1)#
	ID.list <- 1:1000#
		input.conc.data <- data.frame(#
			ID = 1,#
			amt = 5*70,#
			evid = 1,#
			cmt = 1,#
			time = c(0,14,42,98,154,210,266,322),#
			rate = -2#
		)#
	conc.data <- mod %>% data_set(input.conc.data) %>% carry.out(amt) %>% mrgsim(tgrid = TIME.tgrid)#
	conc.data <- as.data.frame(conc.data)#
	plotobj2 <- NULL#
	plotobj2 <- ggplot(conc.data)#
	plotobj2 <- plotobj2 + geom_line(aes(x = time,y = IPRE),colour = "blue")#
	plotobj2 <- plotobj2 + scale_x_continuous("\nTime (hours)")#
	plotobj2 <- plotobj2 + scale_y_log10("Infliximab Concentration (mg/L)\n",breaks = c(0.001,0.01,0.1,1,10,100,100),labels = c(0.001,0.01,0.1,1,10,100,100))#
	plotobj2
rm(list=ls(all=TRUE))#
	library(deSolve)	#
	library(ggplot2)	#
	library(plyr)	#
	library(grid)	#
	library(compiler)	#
	library(mrgsolve)	#
	setwd("/Volumes/Prosecutor/PhD/InfliximabBayes/infliximab-bayes/")#
	theme_bw2 <- theme_set(theme_bw(base_size = 16))#
	sumfuncx <- function(x) {#
		stat1 <- median(x)#
		stat2 <- quantile(x,probs = 0.025,names = F)#
		stat3 <- quantile(x,probs = 0.975,names = F)#
		stat4 <- length(x)#
		result <- c("median" = stat1,"low" = stat2,"hi" = stat3,"n" = stat4)#
		result#
	}#
	set.seed(123456)#
		code <- '#
		$CMT			// Specify compartments#
							CENT,	// Central#
							PERI, // Peripheral#
							TUT,	// Time below target compartment#
							ALB	// Albumin, U/L#
		$PARAM		// Population parameters#
							POPCL = 0.294,#
							POPV1 = 3.33,#
							POPQ = 0.0719,#
							POPV2 = 1.14,#
							// Covariate effects#
							WT_CL = 0.614,	// Effect of weight on clearance#
							WT_V1 = 0.691,	// Effect of weight on V1#
							WT_Q = 1.1,	// Effect of weight on Q#
							WT_V2 = 0.59,	// Effect of weight on V2#
							ALB_CL = -1.17,	// Effect of albumin on clearance#
							ADA_CL = 0.257,	// Effect of anti-drug antibodies on clearance#
							// Covariate values for simulation#
							WT = 70,	// Weight (kg)#
							BASE_ALB = 4,	// Baseline albumin at treatment initiation#
							ADA = 0,	// Anti-drug antibodies (0 = No, 1 = Yes)#
							target = 3	// Target trough concentration (mg/L)#
		$OMEGA		name = "BSV"#
							block = FALSE#
							labels = s(PPVCL,PPVV1,PPVQ,PPVV2)#
							0.106929#
							0.0225#
							1.21#
							0.638401#
		$SIGMA		block = FALSE#
							labels = s(ERRPRO)#
							0.175561#
		$MAIN			// Infusion duration#
							D_CENT = 0.08333333;  // 2 hours#
							// Compartment initial conditions#
							CENT_0 = 0;#
							PERI_0 = 0;#
							TUT_0 = 0;#
							ALB_0 = BASE_ALB;#
							// Covariate effects#
							double ADACOV = 1;	// No anti-drug antibodies#
							if (ADA == 1) ADACOV = 1+ADA_CL;		// Anti-drug antibodies#
							// Individual parameter values#
							double CL = POPCL*pow(WT/70,WT_CL)*pow(ALB/4,ALB_CL)*ADACOV*exp(PPVCL);#
							double V1 = POPV1*pow(WT/70,WT_V1)*exp(PPVV1);#
							double Q = POPQ*pow(WT/70,WT_Q)*exp(PPVQ);#
							double V2 = POPV2*pow(WT/70,WT_V2)*exp(PPVV2);#
		$ODE			// Differential equations#
							dxdt_CENT = -Q/V1*CENT +Q/V2*PERI -CL/V1*CENT;#
							dxdt_PERI = Q/V1*CENT -Q/V2*PERI;#
							// Time under target#
							double CP = CENT/V1;	// Plasma concentration of the central compartment#
							dxdt_TUT = 0;#
							if (CP < target) dxdt_TUT = 1;#
							// Proportion of time under target#
							double pTUT = 0;#
							if (SOLVERTIME > 0.08333333) pTUT = TUT/SOLVERTIME;#
							// Albumin#
							dxdt_ALB = ALB*(0.1-pTUT)-4;#
		$TABLE		table(IPRE) = CENT/V1;#
							table(DV) = table(IPRE)*exp(ERRPRO);#
		$CAPTURE	WT ADA ALB CL V1 Q V2 PPVCL PPVV1 PPVQ PPVV2 pTUT#
		'#
		mod <- mcode("popINFLIX",code)#
	TIME.tgrid <- tgrid(0,365,1)#
	ID.list <- 1:1000#
		input.conc.data <- data.frame(#
			ID = 1,#
			amt = 5*70,#
			evid = 1,#
			cmt = 1,#
			time = c(0,14,42,98,154,210,266,322),#
			rate = -2#
		)#
	conc.data <- mod %>% data_set(input.conc.data) %>% carry.out(amt) %>% mrgsim(tgrid = TIME.tgrid)#
	conc.data <- as.data.frame(conc.data)#
	plotobj2 <- NULL#
	plotobj2 <- ggplot(conc.data)#
	plotobj2 <- plotobj2 + geom_line(aes(x = time,y = IPRE),colour = "blue")#
	plotobj2 <- plotobj2 + scale_x_continuous("\nTime (hours)")#
	plotobj2 <- plotobj2 + scale_y_log10("Infliximab Concentration (mg/L)\n",breaks = c(0.001,0.01,0.1,1,10,100,100),labels = c(0.001,0.01,0.1,1,10,100,100))#
	plotobj2
rm(list=ls(all=TRUE))#
	library(deSolve)	#
	library(ggplot2)	#
	library(plyr)	#
	library(grid)	#
	library(compiler)	#
	library(mrgsolve)	#
	setwd("/Volumes/Prosecutor/PhD/InfliximabBayes/infliximab-bayes/")#
	theme_bw2 <- theme_set(theme_bw(base_size = 16))#
	sumfuncx <- function(x) {#
		stat1 <- median(x)#
		stat2 <- quantile(x,probs = 0.025,names = F)#
		stat3 <- quantile(x,probs = 0.975,names = F)#
		stat4 <- length(x)#
		result <- c("median" = stat1,"low" = stat2,"hi" = stat3,"n" = stat4)#
		result#
	}#
	set.seed(123456)#
		code <- '#
		$CMT			// Specify compartments#
							CENT,	// Central#
							PERI, // Peripheral#
							TUT,	// Time below target compartment#
							ALB	// Albumin, U/L#
		$PARAM		// Population parameters#
							POPCL = 0.294,#
							POPV1 = 3.33,#
							POPQ = 0.0719,#
							POPV2 = 1.14,#
							// Covariate effects#
							WT_CL = 0.614,	// Effect of weight on clearance#
							WT_V1 = 0.691,	// Effect of weight on V1#
							WT_Q = 1.1,	// Effect of weight on Q#
							WT_V2 = 0.59,	// Effect of weight on V2#
							ALB_CL = -1.17,	// Effect of albumin on clearance#
							ADA_CL = 0.257,	// Effect of anti-drug antibodies on clearance#
							// Covariate values for simulation#
							WT = 70,	// Weight (kg)#
							BASE_ALB = 4,	// Baseline albumin at treatment initiation#
							ADA = 0,	// Anti-drug antibodies (0 = No, 1 = Yes)#
							target = 3	// Target trough concentration (mg/L)#
		$OMEGA		name = "BSV"#
							block = FALSE#
							labels = s(PPVCL,PPVV1,PPVQ,PPVV2)#
							0.106929#
							0.0225#
							1.21#
							0.638401#
		$SIGMA		block = FALSE#
							labels = s(ERRPRO)#
							0.175561#
		$MAIN			// Infusion duration#
							D_CENT = 0.08333333;  // 2 hours#
							// Compartment initial conditions#
							CENT_0 = 0;#
							PERI_0 = 0;#
							TUT_0 = 0;#
							ALB_0 = BASE_ALB;#
							// Covariate effects#
							double ADACOV = 1;	// No anti-drug antibodies#
							if (ADA == 1) ADACOV = 1+ADA_CL;		// Anti-drug antibodies#
							// Individual parameter values#
							double CL = POPCL*pow(WT/70,WT_CL)*pow(ALB/4,ALB_CL)*ADACOV*exp(PPVCL);#
							double V1 = POPV1*pow(WT/70,WT_V1)*exp(PPVV1);#
							double Q = POPQ*pow(WT/70,WT_Q)*exp(PPVQ);#
							double V2 = POPV2*pow(WT/70,WT_V2)*exp(PPVV2);#
		$ODE			// Differential equations#
							dxdt_CENT = -Q/V1*CENT +Q/V2*PERI -CL/V1*CENT;#
							dxdt_PERI = Q/V1*CENT -Q/V2*PERI;#
							// Time under target#
							double CP = CENT/V1;	// Plasma concentration of the central compartment#
							dxdt_TUT = 0;#
							if (CP < target) dxdt_TUT = 1;#
							// Proportion of time under target#
							double pTUT = 0;#
							if (SOLVERTIME > 0.08333333) pTUT = TUT/SOLVERTIME;#
							// Albumin#
							dxdt_ALB = ALB*(0.1-pTUT);#
		$TABLE		table(IPRE) = CENT/V1;#
							table(DV) = table(IPRE)*exp(ERRPRO);#
		$CAPTURE	WT ADA ALB CL V1 Q V2 PPVCL PPVV1 PPVQ PPVV2 pTUT#
		'#
		mod <- mcode("popINFLIX",code)#
	TIME.tgrid <- tgrid(0,365,1)#
	ID.list <- 1:1000#
		input.conc.data <- data.frame(#
			ID = 1,#
			amt = 5*70,#
			evid = 1,#
			cmt = 1,#
			time = c(0,14,42,98,154,210,266,322),#
			rate = -2#
		)#
	conc.data <- mod %>% data_set(input.conc.data) %>% carry.out(amt) %>% mrgsim(tgrid = TIME.tgrid)#
	conc.data <- as.data.frame(conc.data)#
	plotobj2 <- NULL#
	plotobj2 <- ggplot(conc.data)#
	plotobj2 <- plotobj2 + geom_line(aes(x = time,y = IPRE),colour = "blue")#
	plotobj2 <- plotobj2 + scale_x_continuous("\nTime (hours)")#
	plotobj2 <- plotobj2 + scale_y_log10("Infliximab Concentration (mg/L)\n",breaks = c(0.001,0.01,0.1,1,10,100,100),labels = c(0.001,0.01,0.1,1,10,100,100))#
	plotobj2
rm(list=ls(all=TRUE))#
	library(deSolve)	#
	library(ggplot2)	#
	library(plyr)	#
	library(grid)	#
	library(compiler)	#
	library(mrgsolve)	#
	setwd("/Volumes/Prosecutor/PhD/InfliximabBayes/infliximab-bayes/")#
	theme_bw2 <- theme_set(theme_bw(base_size = 16))#
	sumfuncx <- function(x) {#
		stat1 <- median(x)#
		stat2 <- quantile(x,probs = 0.025,names = F)#
		stat3 <- quantile(x,probs = 0.975,names = F)#
		stat4 <- length(x)#
		result <- c("median" = stat1,"low" = stat2,"hi" = stat3,"n" = stat4)#
		result#
	}#
	set.seed(123456)#
		code <- '#
		$CMT			// Specify compartments#
							CENT,	// Central#
							PERI, // Peripheral#
							TUT,	// Time below target compartment#
							ALB	// Albumin, U/L#
		$PARAM		// Population parameters#
							POPCL = 0.294,#
							POPV1 = 3.33,#
							POPQ = 0.0719,#
							POPV2 = 1.14,#
							// Covariate effects#
							WT_CL = 0.614,	// Effect of weight on clearance#
							WT_V1 = 0.691,	// Effect of weight on V1#
							WT_Q = 1.1,	// Effect of weight on Q#
							WT_V2 = 0.59,	// Effect of weight on V2#
							ALB_CL = -1.17,	// Effect of albumin on clearance#
							ADA_CL = 0.257,	// Effect of anti-drug antibodies on clearance#
							// Covariate values for simulation#
							WT = 70,	// Weight (kg)#
							BASE_ALB = 2,	// Baseline albumin at treatment initiation#
							ADA = 0,	// Anti-drug antibodies (0 = No, 1 = Yes)#
							target = 3	// Target trough concentration (mg/L)#
		$OMEGA		name = "BSV"#
							block = FALSE#
							labels = s(PPVCL,PPVV1,PPVQ,PPVV2)#
							0.106929#
							0.0225#
							1.21#
							0.638401#
		$SIGMA		block = FALSE#
							labels = s(ERRPRO)#
							0.175561#
		$MAIN			// Infusion duration#
							D_CENT = 0.08333333;  // 2 hours#
							// Compartment initial conditions#
							CENT_0 = 0;#
							PERI_0 = 0;#
							TUT_0 = 0;#
							ALB_0 = BASE_ALB;#
							// Covariate effects#
							double ADACOV = 1;	// No anti-drug antibodies#
							if (ADA == 1) ADACOV = 1+ADA_CL;		// Anti-drug antibodies#
							// Individual parameter values#
							double CL = POPCL*pow(WT/70,WT_CL)*pow(ALB/4,ALB_CL)*ADACOV*exp(PPVCL);#
							double V1 = POPV1*pow(WT/70,WT_V1)*exp(PPVV1);#
							double Q = POPQ*pow(WT/70,WT_Q)*exp(PPVQ);#
							double V2 = POPV2*pow(WT/70,WT_V2)*exp(PPVV2);#
		$ODE			// Differential equations#
							dxdt_CENT = -Q/V1*CENT +Q/V2*PERI -CL/V1*CENT;#
							dxdt_PERI = Q/V1*CENT -Q/V2*PERI;#
							// Time under target#
							double CP = CENT/V1;	// Plasma concentration of the central compartment#
							dxdt_TUT = 0;#
							if (CP < target) dxdt_TUT = 1;#
							// Proportion of time under target#
							double pTUT = 0;#
							if (SOLVERTIME > 0.08333333) pTUT = TUT/SOLVERTIME;#
							// Albumin#
							dxdt_ALB = ALB*(0.1-pTUT);#
		$TABLE		table(IPRE) = CENT/V1;#
							table(DV) = table(IPRE)*exp(ERRPRO);#
		$CAPTURE	WT ADA ALB CL V1 Q V2 PPVCL PPVV1 PPVQ PPVV2 pTUT#
		'#
		mod <- mcode("popINFLIX",code)#
	TIME.tgrid <- tgrid(0,365,1)#
	ID.list <- 1:1000#
		input.conc.data <- data.frame(#
			ID = 1,#
			amt = 5*70,#
			evid = 1,#
			cmt = 1,#
			time = c(0,14,42,98,154,210,266,322),#
			rate = -2#
		)#
	conc.data <- mod %>% data_set(input.conc.data) %>% carry.out(amt) %>% mrgsim(tgrid = TIME.tgrid)#
	conc.data <- as.data.frame(conc.data)#
	plotobj2 <- NULL#
	plotobj2 <- ggplot(conc.data)#
	plotobj2 <- plotobj2 + geom_line(aes(x = time,y = IPRE),colour = "blue")#
	plotobj2 <- plotobj2 + scale_x_continuous("\nTime (hours)")#
	plotobj2 <- plotobj2 + scale_y_log10("Infliximab Concentration (mg/L)\n",breaks = c(0.001,0.01,0.1,1,10,100,100),labels = c(0.001,0.01,0.1,1,10,100,100))#
	plotobj2
rm(list=ls(all=TRUE))#
	library(deSolve)	#
	library(ggplot2)	#
	library(plyr)	#
	library(grid)	#
	library(compiler)	#
	library(mrgsolve)	#
	setwd("/Volumes/Prosecutor/PhD/InfliximabBayes/infliximab-bayes/")#
	theme_bw2 <- theme_set(theme_bw(base_size = 16))#
	sumfuncx <- function(x) {#
		stat1 <- median(x)#
		stat2 <- quantile(x,probs = 0.025,names = F)#
		stat3 <- quantile(x,probs = 0.975,names = F)#
		stat4 <- length(x)#
		result <- c("median" = stat1,"low" = stat2,"hi" = stat3,"n" = stat4)#
		result#
	}#
	set.seed(123456)#
		code <- '#
		$CMT			// Specify compartments#
							CENT,	// Central#
							PERI, // Peripheral#
							TUT,	// Time below target compartment#
							ALB	// Albumin, U/L#
		$PARAM		// Population parameters#
							POPCL = 0.294,#
							POPV1 = 3.33,#
							POPQ = 0.0719,#
							POPV2 = 1.14,#
							// Covariate effects#
							WT_CL = 0.614,	// Effect of weight on clearance#
							WT_V1 = 0.691,	// Effect of weight on V1#
							WT_Q = 1.1,	// Effect of weight on Q#
							WT_V2 = 0.59,	// Effect of weight on V2#
							ALB_CL = -1.17,	// Effect of albumin on clearance#
							ADA_CL = 0.257,	// Effect of anti-drug antibodies on clearance#
							// Covariate values for simulation#
							WT = 70,	// Weight (kg)#
							BASE_ALB = 2,	// Baseline albumin at treatment initiation#
							ADA = 0,	// Anti-drug antibodies (0 = No, 1 = Yes)#
							target = 3	// Target trough concentration (mg/L)#
		$OMEGA		name = "BSV"#
							block = FALSE#
							labels = s(PPVCL,PPVV1,PPVQ,PPVV2)#
							0.106929#
							0.0225#
							1.21#
							0.638401#
		$SIGMA		block = FALSE#
							labels = s(ERRPRO)#
							0.175561#
		$MAIN			// Infusion duration#
							D_CENT = 0.08333333;  // 2 hours#
							// Compartment initial conditions#
							CENT_0 = 0;#
							PERI_0 = 0;#
							TUT_0 = 0;#
							ALB_0 = BASE_ALB;#
							// Covariate effects#
							double ADACOV = 1;	// No anti-drug antibodies#
							if (ADA == 1) ADACOV = 1+ADA_CL;		// Anti-drug antibodies#
							// Individual parameter values#
							double CL = POPCL*pow(WT/70,WT_CL)*pow(ALB/4,ALB_CL)*ADACOV*exp(PPVCL);#
							double V1 = POPV1*pow(WT/70,WT_V1)*exp(PPVV1);#
							double Q = POPQ*pow(WT/70,WT_Q)*exp(PPVQ);#
							double V2 = POPV2*pow(WT/70,WT_V2)*exp(PPVV2);#
		$ODE			// Differential equations#
							dxdt_CENT = -Q/V1*CENT +Q/V2*PERI -CL/V1*CENT;#
							dxdt_PERI = Q/V1*CENT -Q/V2*PERI;#
							// Time under target#
							double CP = CENT/V1;	// Plasma concentration of the central compartment#
							dxdt_TUT = 0;#
							if (CP < target) dxdt_TUT = 1;#
							// Proportion of time under target#
							double pTUT = 0;#
							if (SOLVERTIME > 0.08333333) pTUT = TUT/SOLVERTIME;#
							// Albumin#
							dxdt_ALB = ALB*((0.1-pTUT)/1000);#
		$TABLE		table(IPRE) = CENT/V1;#
							table(DV) = table(IPRE)*exp(ERRPRO);#
		$CAPTURE	WT ADA ALB CL V1 Q V2 PPVCL PPVV1 PPVQ PPVV2 pTUT#
		'#
		mod <- mcode("popINFLIX",code)#
	TIME.tgrid <- tgrid(0,365,1)#
	ID.list <- 1:1000#
		input.conc.data <- data.frame(#
			ID = 1,#
			amt = 5*70,#
			evid = 1,#
			cmt = 1,#
			time = c(0,14,42,98,154,210,266,322),#
			rate = -2#
		)#
	conc.data <- mod %>% data_set(input.conc.data) %>% carry.out(amt) %>% mrgsim(tgrid = TIME.tgrid)#
	conc.data <- as.data.frame(conc.data)#
	plotobj2 <- NULL#
	plotobj2 <- ggplot(conc.data)#
	plotobj2 <- plotobj2 + geom_line(aes(x = time,y = IPRE),colour = "blue")#
	plotobj2 <- plotobj2 + scale_x_continuous("\nTime (hours)")#
	plotobj2 <- plotobj2 + scale_y_log10("Infliximab Concentration (mg/L)\n",breaks = c(0.001,0.01,0.1,1,10,100,100),labels = c(0.001,0.01,0.1,1,10,100,100))#
	plotobj2
rm(list=ls(all=TRUE))#
	library(deSolve)	#
	library(ggplot2)	#
	library(plyr)	#
	library(grid)	#
	library(compiler)	#
	library(mrgsolve)	#
	setwd("/Volumes/Prosecutor/PhD/InfliximabBayes/infliximab-bayes/")#
	theme_bw2 <- theme_set(theme_bw(base_size = 16))#
	sumfuncx <- function(x) {#
		stat1 <- median(x)#
		stat2 <- quantile(x,probs = 0.025,names = F)#
		stat3 <- quantile(x,probs = 0.975,names = F)#
		stat4 <- length(x)#
		result <- c("median" = stat1,"low" = stat2,"hi" = stat3,"n" = stat4)#
		result#
	}#
	set.seed(123456)#
		code <- '#
		$CMT			// Specify compartments#
							CENT,	// Central#
							PERI, // Peripheral#
							TUT,	// Time below target compartment#
							ALB	// Albumin, U/L#
		$PARAM		// Population parameters#
							POPCL = 0.294,#
							POPV1 = 3.33,#
							POPQ = 0.0719,#
							POPV2 = 1.14,#
							// Covariate effects#
							WT_CL = 0.614,	// Effect of weight on clearance#
							WT_V1 = 0.691,	// Effect of weight on V1#
							WT_Q = 1.1,	// Effect of weight on Q#
							WT_V2 = 0.59,	// Effect of weight on V2#
							ALB_CL = -1.17,	// Effect of albumin on clearance#
							ADA_CL = 0.257,	// Effect of anti-drug antibodies on clearance#
							// Covariate values for simulation#
							WT = 70,	// Weight (kg)#
							BASE_ALB = 4,	// Baseline albumin at treatment initiation#
							ADA = 0,	// Anti-drug antibodies (0 = No, 1 = Yes)#
							target = 3	// Target trough concentration (mg/L)#
		$OMEGA		name = "BSV"#
							block = FALSE#
							labels = s(PPVCL,PPVV1,PPVQ,PPVV2)#
							0.106929#
							0.0225#
							1.21#
							0.638401#
		$SIGMA		block = FALSE#
							labels = s(ERRPRO)#
							0.175561#
		$MAIN			// Infusion duration#
							D_CENT = 0.08333333;  // 2 hours#
							// Compartment initial conditions#
							CENT_0 = 0;#
							PERI_0 = 0;#
							TUT_0 = 0;#
							ALB_0 = BASE_ALB;#
							// Covariate effects#
							double ADACOV = 1;	// No anti-drug antibodies#
							if (ADA == 1) ADACOV = 1+ADA_CL;		// Anti-drug antibodies#
							// Individual parameter values#
							double CL = POPCL*pow(WT/70,WT_CL)*pow(ALB/4,ALB_CL)*ADACOV*exp(PPVCL);#
							double V1 = POPV1*pow(WT/70,WT_V1)*exp(PPVV1);#
							double Q = POPQ*pow(WT/70,WT_Q)*exp(PPVQ);#
							double V2 = POPV2*pow(WT/70,WT_V2)*exp(PPVV2);#
		$ODE			// Differential equations#
							dxdt_CENT = -Q/V1*CENT +Q/V2*PERI -CL/V1*CENT;#
							dxdt_PERI = Q/V1*CENT -Q/V2*PERI;#
							// Time under target#
							double CP = CENT/V1;	// Plasma concentration of the central compartment#
							dxdt_TUT = 0;#
							if (CP < target) dxdt_TUT = 1;#
							// Proportion of time under target#
							double pTUT = 0;#
							if (SOLVERTIME > 0.08333333) pTUT = TUT/SOLVERTIME;#
							// Albumin#
							dxdt_ALB = ALB*((0.1-pTUT)/1000);#
		$TABLE		table(IPRE) = CENT/V1;#
							table(DV) = table(IPRE)*exp(ERRPRO);#
		$CAPTURE	WT ADA ALB CL V1 Q V2 PPVCL PPVV1 PPVQ PPVV2 pTUT#
		'#
		mod <- mcode("popINFLIX",code)#
	TIME.tgrid <- tgrid(0,365,1)#
	ID.list <- 1:1000#
		input.conc.data <- data.frame(#
			ID = 1,#
			amt = 5*70,#
			evid = 1,#
			cmt = 1,#
			time = c(0,14,42,98,154,210,266,322),#
			rate = -2#
		)#
	conc.data <- mod %>% data_set(input.conc.data) %>% carry.out(amt) %>% mrgsim(tgrid = TIME.tgrid)#
	conc.data <- as.data.frame(conc.data)#
	plotobj2 <- NULL#
	plotobj2 <- ggplot(conc.data)#
	plotobj2 <- plotobj2 + geom_line(aes(x = time,y = IPRE),colour = "blue")#
	plotobj2 <- plotobj2 + scale_x_continuous("\nTime (hours)")#
	plotobj2 <- plotobj2 + scale_y_log10("Infliximab Concentration (mg/L)\n",breaks = c(0.001,0.01,0.1,1,10,100,100),labels = c(0.001,0.01,0.1,1,10,100,100))#
	plotobj2
rm(list=ls(all=TRUE))#
	library(deSolve)	#
	library(ggplot2)	#
	library(plyr)	#
	library(grid)	#
	library(compiler)	#
	library(mrgsolve)	#
	setwd("/Volumes/Prosecutor/PhD/InfliximabBayes/infliximab-bayes/")#
	theme_bw2 <- theme_set(theme_bw(base_size = 16))#
	sumfuncx <- function(x) {#
		stat1 <- median(x)#
		stat2 <- quantile(x,probs = 0.025,names = F)#
		stat3 <- quantile(x,probs = 0.975,names = F)#
		stat4 <- length(x)#
		result <- c("median" = stat1,"low" = stat2,"hi" = stat3,"n" = stat4)#
		result#
	}#
	set.seed(123456)#
		code <- '#
		$CMT			// Specify compartments#
							CENT,	// Central#
							PERI, // Peripheral#
							TUT,	// Time below target compartment#
							ALB	// Albumin, U/L#
		$PARAM		// Population parameters#
							POPCL = 0.294,#
							POPV1 = 3.33,#
							POPQ = 0.0719,#
							POPV2 = 1.14,#
							// Covariate effects#
							WT_CL = 0.614,	// Effect of weight on clearance#
							WT_V1 = 0.691,	// Effect of weight on V1#
							WT_Q = 1.1,	// Effect of weight on Q#
							WT_V2 = 0.59,	// Effect of weight on V2#
							ALB_CL = -1.17,	// Effect of albumin on clearance#
							ADA_CL = 0.257,	// Effect of anti-drug antibodies on clearance#
							// Covariate values for simulation#
							WT = 70,	// Weight (kg)#
							BASE_ALB = 4,	// Baseline albumin at treatment initiation#
							ADA = 0,	// Anti-drug antibodies (0 = No, 1 = Yes)#
							target = 3	// Target trough concentration (mg/L)#
		$OMEGA		name = "BSV"#
							block = FALSE#
							labels = s(PPVCL,PPVV1,PPVQ,PPVV2)#
							0.106929#
							0.0225#
							1.21#
							0.638401#
		$SIGMA		block = FALSE#
							labels = s(ERRPRO)#
							0.175561#
		$MAIN			// Infusion duration#
							D_CENT = 0.08333333;  // 2 hours#
							// Compartment initial conditions#
							CENT_0 = 0;#
							PERI_0 = 0;#
							TUT_0 = 0;#
							ALB_0 = BASE_ALB;#
							// Covariate effects#
							double ADACOV = 1;	// No anti-drug antibodies#
							if (ADA == 1) ADACOV = 1+ADA_CL;		// Anti-drug antibodies#
							// Individual parameter values#
							double CL = POPCL*pow(WT/70,WT_CL)*pow(ALB/4,ALB_CL)*ADACOV*exp(PPVCL);#
							double V1 = POPV1*pow(WT/70,WT_V1)*exp(PPVV1);#
							double Q = POPQ*pow(WT/70,WT_Q)*exp(PPVQ);#
							double V2 = POPV2*pow(WT/70,WT_V2)*exp(PPVV2);#
		$ODE			// Differential equations#
							dxdt_CENT = -Q/V1*CENT +Q/V2*PERI -CL/V1*CENT;#
							dxdt_PERI = Q/V1*CENT -Q/V2*PERI;#
							// Time under target#
							double CP = CENT/V1;	// Plasma concentration of the central compartment#
							dxdt_TUT = 0;#
							if (CP < target) dxdt_TUT = 1;#
							// Proportion of time under target#
							double pTUT = 0;#
							if (SOLVERTIME > 0.08333333) pTUT = TUT/SOLVERTIME;#
							// Albumin#
							dxdt_ALB = ALB*((0.1-pTUT)/100);#
		$TABLE		table(IPRE) = CENT/V1;#
							table(DV) = table(IPRE)*exp(ERRPRO);#
		$CAPTURE	WT ADA ALB CL V1 Q V2 PPVCL PPVV1 PPVQ PPVV2 pTUT#
		'#
		mod <- mcode("popINFLIX",code)#
	TIME.tgrid <- tgrid(0,365,1)#
	ID.list <- 1:1000#
		input.conc.data <- data.frame(#
			ID = 1,#
			amt = 5*70,#
			evid = 1,#
			cmt = 1,#
			time = c(0,14,42,98,154,210,266,322),#
			rate = -2#
		)#
	conc.data <- mod %>% data_set(input.conc.data) %>% carry.out(amt) %>% mrgsim(tgrid = TIME.tgrid)#
	conc.data <- as.data.frame(conc.data)#
	plotobj2 <- NULL#
	plotobj2 <- ggplot(conc.data)#
	plotobj2 <- plotobj2 + geom_line(aes(x = time,y = IPRE),colour = "blue")#
	plotobj2 <- plotobj2 + scale_x_continuous("\nTime (hours)")#
	plotobj2 <- plotobj2 + scale_y_log10("Infliximab Concentration (mg/L)\n",breaks = c(0.001,0.01,0.1,1,10,100,100),labels = c(0.001,0.01,0.1,1,10,100,100))#
	plotobj2
rm(list=ls(all=TRUE))#
	library(deSolve)	#
	library(ggplot2)	#
	library(plyr)	#
	library(grid)	#
	library(compiler)	#
	library(mrgsolve)	#
	setwd("/Volumes/Prosecutor/PhD/InfliximabBayes/infliximab-bayes/")#
	theme_bw2 <- theme_set(theme_bw(base_size = 16))#
	sumfuncx <- function(x) {#
		stat1 <- median(x)#
		stat2 <- quantile(x,probs = 0.025,names = F)#
		stat3 <- quantile(x,probs = 0.975,names = F)#
		stat4 <- length(x)#
		result <- c("median" = stat1,"low" = stat2,"hi" = stat3,"n" = stat4)#
		result#
	}#
	set.seed(123456)#
		code <- '#
		$CMT			// Specify compartments#
							CENT,	// Central#
							PERI, // Peripheral#
							TUT,	// Time below target compartment#
							ALB,	// Albumin, U/L#
							WT	// Weight, kg#
		$PARAM		// Population parameters#
							POPCL = 0.294,#
							POPV1 = 3.33,#
							POPQ = 0.0719,#
							POPV2 = 1.14,#
							// Covariate effects#
							WT_CL = 0.614,	// Effect of weight on clearance#
							WT_V1 = 0.691,	// Effect of weight on V1#
							WT_Q = 1.1,	// Effect of weight on Q#
							WT_V2 = 0.59,	// Effect of weight on V2#
							ALB_CL = -1.17,	// Effect of albumin on clearance#
							ADA_CL = 0.257,	// Effect of anti-drug antibodies on clearance#
							// Covariate values for simulation#
							BASE_WT = 70,	// Weight (kg)#
							BASE_ALB = 4,	// Baseline albumin at treatment initiation#
							ADA = 0,	// Anti-drug antibodies (0 = No, 1 = Yes)#
							target = 3	// Target trough concentration (mg/L)#
		$OMEGA		name = "BSV"#
							block = FALSE#
							labels = s(PPVCL,PPVV1,PPVQ,PPVV2)#
							0.106929#
							0.0225#
							1.21#
							0.638401#
		$SIGMA		block = FALSE#
							labels = s(ERRPRO)#
							0.175561#
		$MAIN			// Infusion duration#
							D_CENT = 0.08333333;  // 2 hours#
							// Compartment initial conditions#
							CENT_0 = 0;#
							PERI_0 = 0;#
							TUT_0 = 0;#
							ALB_0 = BASE_ALB;#
							WT_0 = BASE_WT;#
							// Covariate effects#
							double ADACOV = 1;	// No anti-drug antibodies#
							if (ADA == 1) ADACOV = 1+ADA_CL;		// Anti-drug antibodies#
							// Individual parameter values#
							double CL = POPCL*pow(WT/70,WT_CL)*pow(ALB/4,ALB_CL)*ADACOV*exp(PPVCL);#
							double V1 = POPV1*pow(WT/70,WT_V1)*exp(PPVV1);#
							double Q = POPQ*pow(WT/70,WT_Q)*exp(PPVQ);#
							double V2 = POPV2*pow(WT/70,WT_V2)*exp(PPVV2);#
		$ODE			// Differential equations#
							dxdt_CENT = -Q/V1*CENT +Q/V2*PERI -CL/V1*CENT;#
							dxdt_PERI = Q/V1*CENT -Q/V2*PERI;#
							// Time under target#
							double CP = CENT/V1;	// Plasma concentration of the central compartment#
							dxdt_TUT = 0;#
							if (CP < target) dxdt_TUT = 1;#
							// Proportion of time under target#
							double pTUT = 0;#
							if (SOLVERTIME > 0.08333333) pTUT = TUT/SOLVERTIME;#
							// Albumin#
							dxdt_ALB = ALB*((0.1-pTUT)/100);#
							// Weight#
							dxdt_WT = WT*((0.1-pTUT)/100);#
		$TABLE		table(IPRE) = CENT/V1;#
							table(DV) = table(IPRE)*exp(ERRPRO);#
		$CAPTURE	WT ADA ALB CL V1 Q V2 PPVCL PPVV1 PPVQ PPVV2 pTUT#
		'#
		mod <- mcode("popINFLIX",code)#
	TIME.tgrid <- tgrid(0,365,1)#
	ID.list <- 1:1000#
		input.conc.data <- data.frame(#
			ID = 1,#
			amt = 5*70,#
			evid = 1,#
			cmt = 1,#
			time = c(0,14,42,98,154,210,266,322),#
			rate = -2#
		)#
	conc.data <- mod %>% data_set(input.conc.data) %>% carry.out(amt) %>% mrgsim(tgrid = TIME.tgrid)#
	conc.data <- as.data.frame(conc.data)#
	plotobj2 <- NULL#
	plotobj2 <- ggplot(conc.data)#
	plotobj2 <- plotobj2 + geom_line(aes(x = time,y = IPRE),colour = "blue")#
	plotobj2 <- plotobj2 + scale_x_continuous("\nTime (hours)")#
	plotobj2 <- plotobj2 + scale_y_log10("Infliximab Concentration (mg/L)\n",breaks = c(0.001,0.01,0.1,1,10,100,100),labels = c(0.001,0.01,0.1,1,10,100,100))#
	plotobj2
rm(list=ls(all=TRUE))#
	library(deSolve)	#
	library(ggplot2)	#
	library(plyr)	#
	library(grid)	#
	library(compiler)	#
	library(mrgsolve)	#
	setwd("/Volumes/Prosecutor/PhD/InfliximabBayes/infliximab-bayes/")#
	theme_bw2 <- theme_set(theme_bw(base_size = 16))#
	sumfuncx <- function(x) {#
		stat1 <- median(x)#
		stat2 <- quantile(x,probs = 0.025,names = F)#
		stat3 <- quantile(x,probs = 0.975,names = F)#
		stat4 <- length(x)#
		result <- c("median" = stat1,"low" = stat2,"hi" = stat3,"n" = stat4)#
		result#
	}#
	set.seed(123456)#
		code <- '#
		$CMT			// Specify compartments#
							CENT,	// Central#
							PERI, // Peripheral#
							TUT,	// Time below target compartment#
							ALB,	// Albumin, U/L#
							WT	// Weight, kg#
		$PARAM		// Population parameters#
							POPCL = 0.294,#
							POPV1 = 3.33,#
							POPQ = 0.0719,#
							POPV2 = 1.14,#
							// Covariate effects#
							WT_CL = 0.614,	// Effect of weight on clearance#
							WT_V1 = 0.691,	// Effect of weight on V1#
							WT_Q = 1.1,	// Effect of weight on Q#
							WT_V2 = 0.59,	// Effect of weight on V2#
							ALB_CL = -1.17,	// Effect of albumin on clearance#
							ADA_CL = 0.257,	// Effect of anti-drug antibodies on clearance#
							// Covariate values for simulation#
							BASE_WT = 70,	// Weight (kg)#
							BASE_ALB = 4,	// Baseline albumin at treatment initiation#
							ADA = 0,	// Anti-drug antibodies (0 = No, 1 = Yes)#
							target = 3	// Target trough concentration (mg/L)#
		$OMEGA		name = "BSV"#
							block = FALSE#
							labels = s(PPVCL,PPVV1,PPVQ,PPVV2)#
							0.106929#
							0.0225#
							1.21#
							0.638401#
		$SIGMA		block = FALSE#
							labels = s(ERRPRO)#
							0.175561#
		$MAIN			// Infusion duration#
							D_CENT = 0.08333333;  // 2 hours#
							// Compartment initial conditions#
							CENT_0 = 0;#
							PERI_0 = 0;#
							TUT_0 = 0;#
							ALB_0 = BASE_ALB;#
							WT_0 = BASE_WT;#
							// Covariate effects#
							double ADACOV = 1;	// No anti-drug antibodies#
							if (ADA == 1) ADACOV = 1+ADA_CL;		// Anti-drug antibodies#
							// Individual parameter values#
							double CL = POPCL*pow(WT/70,WT_CL)*pow(ALB/4,ALB_CL)*ADACOV*exp(PPVCL);#
							double V1 = POPV1*pow(WT/70,WT_V1)*exp(PPVV1);#
							double Q = POPQ*pow(WT/70,WT_Q)*exp(PPVQ);#
							double V2 = POPV2*pow(WT/70,WT_V2)*exp(PPVV2);#
		$ODE			// Differential equations#
							dxdt_CENT = -Q/V1*CENT +Q/V2*PERI -CL/V1*CENT;#
							dxdt_PERI = Q/V1*CENT -Q/V2*PERI;#
							// Time under target#
							double CP = CENT/V1;	// Plasma concentration of the central compartment#
							dxdt_TUT = 0;#
							if (CP < target) dxdt_TUT = 1;#
							// Proportion of time under target#
							double pTUT = 0;#
							if (SOLVERTIME > 0.08333333) pTUT = TUT/SOLVERTIME;#
							// Albumin#
							dxdt_ALB = ALB*((0.1-pTUT)/100);#
							// Weight#
							dxdt_WT = WT*((0.1-pTUT)/1000);#
		$TABLE		table(IPRE) = CENT/V1;#
							table(DV) = table(IPRE)*exp(ERRPRO);#
		$CAPTURE	WT ADA ALB CL V1 Q V2 PPVCL PPVV1 PPVQ PPVV2 pTUT#
		'#
		mod <- mcode("popINFLIX",code)#
	TIME.tgrid <- tgrid(0,365,1)#
	ID.list <- 1:1000#
		input.conc.data <- data.frame(#
			ID = 1,#
			amt = 5*70,#
			evid = 1,#
			cmt = 1,#
			time = c(0,14,42,98,154,210,266,322),#
			rate = -2#
		)#
	conc.data <- mod %>% data_set(input.conc.data) %>% carry.out(amt) %>% mrgsim(tgrid = TIME.tgrid)#
	conc.data <- as.data.frame(conc.data)#
	plotobj2 <- NULL#
	plotobj2 <- ggplot(conc.data)#
	plotobj2 <- plotobj2 + geom_line(aes(x = time,y = IPRE),colour = "blue")#
	plotobj2 <- plotobj2 + scale_x_continuous("\nTime (hours)")#
	plotobj2 <- plotobj2 + scale_y_log10("Infliximab Concentration (mg/L)\n",breaks = c(0.001,0.01,0.1,1,10,100,100),labels = c(0.001,0.01,0.1,1,10,100,100))#
	plotobj2
rm(list=ls(all=TRUE))#
	library(deSolve)	#
	library(ggplot2)	#
	library(plyr)	#
	library(grid)	#
	library(compiler)	#
	library(mrgsolve)	#
	setwd("/Volumes/Prosecutor/PhD/InfliximabBayes/infliximab-bayes/")#
	theme_bw2 <- theme_set(theme_bw(base_size = 16))#
	sumfuncx <- function(x) {#
		stat1 <- median(x)#
		stat2 <- quantile(x,probs = 0.025,names = F)#
		stat3 <- quantile(x,probs = 0.975,names = F)#
		stat4 <- length(x)#
		result <- c("median" = stat1,"low" = stat2,"hi" = stat3,"n" = stat4)#
		result#
	}#
	set.seed(123456)#
		code <- '#
		$CMT			// Specify compartments#
							CENT,	// Central#
							PERI, // Peripheral#
							TUT,	// Time below target compartment#
							ALB,	// Albumin, U/L#
							WT	// Weight, kg#
		$PARAM		// Population parameters#
							POPCL = 0.294,#
							POPV1 = 3.33,#
							POPQ = 0.0719,#
							POPV2 = 1.14,#
							// Covariate effects#
							WT_CL = 0.614,	// Effect of weight on clearance#
							WT_V1 = 0.691,	// Effect of weight on V1#
							WT_Q = 1.1,	// Effect of weight on Q#
							WT_V2 = 0.59,	// Effect of weight on V2#
							ALB_CL = -1.17,	// Effect of albumin on clearance#
							ADA_CL = 0.257,	// Effect of anti-drug antibodies on clearance#
							// Covariate values for simulation#
							BASE_WT = 70,	// Weight (kg)#
							BASE_ALB = 4,	// Baseline albumin at treatment initiation#
							target = 3	// Target trough concentration (mg/L)#
		$OMEGA		name = "BSV"#
							block = FALSE#
							labels = s(PPVCL,PPVV1,PPVQ,PPVV2)#
							0.106929#
							0.0225#
							1.21#
							0.638401#
		$SIGMA		block = FALSE#
							labels = s(ERRPRO)#
							0.175561#
		$MAIN			// Infusion duration#
							D_CENT = 0.08333333;  // 2 hours#
							// Compartment initial conditions#
							CENT_0 = 0;#
							PERI_0 = 0;#
							TUT_0 = 0;#
							ALB_0 = BASE_ALB;#
							WT_0 = BASE_WT;#
							// Covariate effects#
							double ADACOV = 1;	// No anti-drug antibodies#
							if (ADA == 1) ADACOV = 1+ADA_CL;		// Anti-drug antibodies#
							// Individual parameter values#
							double CL = POPCL*pow(WT/70,WT_CL)*pow(ALB/4,ALB_CL)*ADACOV*exp(PPVCL);#
							double V1 = POPV1*pow(WT/70,WT_V1)*exp(PPVV1);#
							double Q = POPQ*pow(WT/70,WT_Q)*exp(PPVQ);#
							double V2 = POPV2*pow(WT/70,WT_V2)*exp(PPVV2);#
		$ODE			// Differential equations#
							dxdt_CENT = -Q/V1*CENT +Q/V2*PERI -CL/V1*CENT;#
							dxdt_PERI = Q/V1*CENT -Q/V2*PERI;#
							// Time under target#
							double CP = CENT/V1;	// Plasma concentration of the central compartment#
							dxdt_TUT = 0;#
							if (CP < target) dxdt_TUT = 1;#
							// Proportion of time under target#
							double pTUT = 0;#
							if (SOLVERTIME > 0.08333333) pTUT = TUT/SOLVERTIME;#
							// Albumin#
							dxdt_ALB = ALB*((0.1-pTUT)/100);#
							// Weight#
							dxdt_WT = WT*((0.1-pTUT)/100);#
							// Anti-drug antibodies#
							ADA = 0;#
							if (pTUT > 0.1) ADA = 1;#
		$TABLE		table(IPRE) = CENT/V1;#
							table(DV) = table(IPRE)*exp(ERRPRO);#
		$CAPTURE	WT ADA ALB CL V1 Q V2 PPVCL PPVV1 PPVQ PPVV2 pTUT#
		'#
		mod <- mcode("popINFLIX",code)#
	TIME.tgrid <- tgrid(0,365,1)#
	ID.list <- 1:1000#
		input.conc.data <- data.frame(#
			ID = 1,#
			amt = 5*70,#
			evid = 1,#
			cmt = 1,#
			time = c(0,14,42,98,154,210,266,322),#
			rate = -2#
		)#
	conc.data <- mod %>% data_set(input.conc.data) %>% carry.out(amt) %>% mrgsim(tgrid = TIME.tgrid)#
	conc.data <- as.data.frame(conc.data)#
	plotobj2 <- NULL#
	plotobj2 <- ggplot(conc.data)#
	plotobj2 <- plotobj2 + geom_line(aes(x = time,y = IPRE),colour = "blue")#
	plotobj2 <- plotobj2 + scale_x_continuous("\nTime (hours)")#
	plotobj2 <- plotobj2 + scale_y_log10("Infliximab Concentration (mg/L)\n",breaks = c(0.001,0.01,0.1,1,10,100,100),labels = c(0.001,0.01,0.1,1,10,100,100))#
	plotobj2
head(conc.data)
tail(conc.data)
plot(conc.data$ADA ~ conc.data$time, type = "l")
rm(list=ls(all=TRUE))#
	library(deSolve)	#
	library(ggplot2)	#
	library(plyr)	#
	library(grid)	#
	library(compiler)	#
	library(mrgsolve)	#
	setwd("/Volumes/Prosecutor/PhD/InfliximabBayes/infliximab-bayes/")#
	theme_bw2 <- theme_set(theme_bw(base_size = 16))#
	sumfuncx <- function(x) {#
		stat1 <- median(x)#
		stat2 <- quantile(x,probs = 0.025,names = F)#
		stat3 <- quantile(x,probs = 0.975,names = F)#
		stat4 <- length(x)#
		result <- c("median" = stat1,"low" = stat2,"hi" = stat3,"n" = stat4)#
		result#
	}#
	set.seed(123456)#
		code <- '#
		$CMT			// Specify compartments#
							CENT,	// Central#
							PERI, // Peripheral#
							TUT,	// Time below target compartment#
							ALB,	// Albumin, U/L#
							WT	// Weight, kg#
		$PARAM		// Population parameters#
							POPCL = 0.294,#
							POPV1 = 3.33,#
							POPQ = 0.0719,#
							POPV2 = 1.14,#
							// Covariate effects#
							WT_CL = 0.614,	// Effect of weight on clearance#
							WT_V1 = 0.691,	// Effect of weight on V1#
							WT_Q = 1.1,	// Effect of weight on Q#
							WT_V2 = 0.59,	// Effect of weight on V2#
							ALB_CL = -1.17,	// Effect of albumin on clearance#
							ADA_CL = 0.257,	// Effect of anti-drug antibodies on clearance#
							// Covariate values for simulation#
							BASE_WT = 70,	// Weight (kg)#
							BASE_ALB = 4,	// Baseline albumin at treatment initiation#
							target = 3	// Target trough concentration (mg/L)#
		$OMEGA		name = "BSV"#
							block = FALSE#
							labels = s(PPVCL,PPVV1,PPVQ,PPVV2)#
							0.106929#
							0.0225#
							1.21#
							0.638401#
		$SIGMA		block = FALSE#
							labels = s(ERRPRO)#
							0.175561#
		$MAIN			// Infusion duration#
							D_CENT = 0.08333333;  // 2 hours#
							// Compartment initial conditions#
							CENT_0 = 0;#
							PERI_0 = 0;#
							TUT_0 = 0;#
							ALB_0 = BASE_ALB;#
							WT_0 = BASE_WT;#
							// Covariate effects#
							double ADACOV = 1;	// No anti-drug antibodies#
							if (ADA == 1) ADACOV = 1+ADA_CL;		// Anti-drug antibodies#
							// Individual parameter values#
							double CL = POPCL*pow(WT/70,WT_CL)*pow(ALB/4,ALB_CL)*ADACOV*exp(PPVCL);#
							double V1 = POPV1*pow(WT/70,WT_V1)*exp(PPVV1);#
							double Q = POPQ*pow(WT/70,WT_Q)*exp(PPVQ);#
							double V2 = POPV2*pow(WT/70,WT_V2)*exp(PPVV2);#
		$ODE			// Differential equations#
							dxdt_CENT = -Q/V1*CENT +Q/V2*PERI -CL/V1*CENT;#
							dxdt_PERI = Q/V1*CENT -Q/V2*PERI;#
							// Time under target#
							double CP = CENT/V1;	// Plasma concentration of the central compartment#
							dxdt_TUT = 0;#
							if (CP < target) dxdt_TUT = 1;#
							// Proportion of time under target#
							double pTUT = 0;#
							if (SOLVERTIME > 0.08333333) pTUT = TUT/SOLVERTIME;#
							// Albumin#
							dxdt_ALB = ALB*(BASE_ALB*(0.1-pTUT)/100);#
							// Weight#
							dxdt_WT = WT*(BASE_WT*(0.1-pTUT)/100);#
							// Anti-drug antibodies#
							double ADA = 0;#
							if (pTUT > 0.1) ADA = 1;#
		$TABLE		table(IPRE) = CENT/V1;#
							table(DV) = table(IPRE)*exp(ERRPRO);#
		$CAPTURE	WT ADA ALB CL V1 Q V2 PPVCL PPVV1 PPVQ PPVV2 pTUT#
		'#
		mod <- mcode("popINFLIX",code)#
	TIME.tgrid <- tgrid(0,365,1)#
	ID.list <- 1:1000#
		input.conc.data <- data.frame(#
			ID = 1,#
			amt = 5*70,#
			evid = 1,#
			cmt = 1,#
			time = c(0,14,42,98,154,210,266,322),#
			rate = -2#
		)#
	conc.data <- mod %>% data_set(input.conc.data) %>% carry.out(amt) %>% mrgsim(tgrid = TIME.tgrid)#
	conc.data <- as.data.frame(conc.data)#
	plotobj2 <- NULL#
	plotobj2 <- ggplot(conc.data)#
	plotobj2 <- plotobj2 + geom_line(aes(x = time,y = IPRE),colour = "blue")#
	plotobj2 <- plotobj2 + scale_x_continuous("\nTime (hours)")#
	plotobj2 <- plotobj2 + scale_y_log10("Infliximab Concentration (mg/L)\n",breaks = c(0.001,0.01,0.1,1,10,100,100),labels = c(0.001,0.01,0.1,1,10,100,100))#
	plotobj2
rm(list=ls(all=TRUE))#
	library(deSolve)	#
	library(ggplot2)	#
	library(plyr)	#
	library(grid)	#
	library(compiler)	#
	library(mrgsolve)	#
	setwd("/Volumes/Prosecutor/PhD/InfliximabBayes/infliximab-bayes/")#
	theme_bw2 <- theme_set(theme_bw(base_size = 16))#
	sumfuncx <- function(x) {#
		stat1 <- median(x)#
		stat2 <- quantile(x,probs = 0.025,names = F)#
		stat3 <- quantile(x,probs = 0.975,names = F)#
		stat4 <- length(x)#
		result <- c("median" = stat1,"low" = stat2,"hi" = stat3,"n" = stat4)#
		result#
	}#
	set.seed(123456)#
		code <- '#
		$CMT			// Specify compartments#
							CENT,	// Central#
							PERI, // Peripheral#
							TUT,	// Time below target compartment#
							ALB,	// Albumin, U/L#
							WT	// Weight, kg#
		$PARAM		// Population parameters#
							POPCL = 0.294,#
							POPV1 = 3.33,#
							POPQ = 0.0719,#
							POPV2 = 1.14,#
							// Covariate effects#
							WT_CL = 0.614,	// Effect of weight on clearance#
							WT_V1 = 0.691,	// Effect of weight on V1#
							WT_Q = 1.1,	// Effect of weight on Q#
							WT_V2 = 0.59,	// Effect of weight on V2#
							ALB_CL = -1.17,	// Effect of albumin on clearance#
							ADA_CL = 0.257,	// Effect of anti-drug antibodies on clearance#
							// Covariate values for simulation#
							BASE_WT = 70,	// Weight (kg)#
							BASE_ALB = 4,	// Baseline albumin at treatment initiation#
							target = 3	// Target trough concentration (mg/L)#
		$OMEGA		name = "BSV"#
							block = FALSE#
							labels = s(PPVCL,PPVV1,PPVQ,PPVV2)#
							0.106929#
							0.0225#
							1.21#
							0.638401#
		$SIGMA		block = FALSE#
							labels = s(ERRPRO)#
							0.175561#
		$MAIN			// Infusion duration#
							D_CENT = 0.08333333;  // 2 hours#
							// Compartment initial conditions#
							CENT_0 = 0;#
							PERI_0 = 0;#
							TUT_0 = 0;#
							ALB_0 = BASE_ALB;#
							WT_0 = BASE_WT;#
							// Covariate effects#
							double ADACOV = 1;	// No anti-drug antibodies#
							if (ADA == 1) ADACOV = 1+ADA_CL;		// Anti-drug antibodies#
							// Individual parameter values#
							double CL = POPCL*pow(WT/70,WT_CL)*pow(ALB/4,ALB_CL)*ADACOV*exp(PPVCL);#
							double V1 = POPV1*pow(WT/70,WT_V1)*exp(PPVV1);#
							double Q = POPQ*pow(WT/70,WT_Q)*exp(PPVQ);#
							double V2 = POPV2*pow(WT/70,WT_V2)*exp(PPVV2);#
		$ODE			// Differential equations#
							dxdt_CENT = -Q/V1*CENT +Q/V2*PERI -CL/V1*CENT;#
							dxdt_PERI = Q/V1*CENT -Q/V2*PERI;#
							// Time under target#
							double CP = CENT/V1;	// Plasma concentration of the central compartment#
							dxdt_TUT = 0;#
							if (CP < target) dxdt_TUT = 1;#
							// Proportion of time under target#
							double pTUT = 0;#
							if (SOLVERTIME > 0.08333333) pTUT = TUT/SOLVERTIME;#
							// Albumin#
							dxdt_ALB = ALB*((0.1-pTUT)/100);#
							// Weight#
							dxdt_WT = WT*((0.1-pTUT)/100);#
							// Anti-drug antibodies#
							double ADA = 0;#
							if (pTUT > 0.1) ADA = 1;#
		$TABLE		table(IPRE) = CENT/V1;#
							table(DV) = table(IPRE)*exp(ERRPRO);#
		$CAPTURE	WT ADA ALB CL V1 Q V2 PPVCL PPVV1 PPVQ PPVV2 pTUT#
		'#
		mod <- mcode("popINFLIX",code)#
	TIME.tgrid <- tgrid(0,365,1)#
	ID.list <- 1:1000#
		input.conc.data <- data.frame(#
			ID = 1,#
			amt = 5*70,#
			evid = 1,#
			cmt = 1,#
			time = c(0,14,42,98,154,210,266,322),#
			rate = -2#
		)#
	conc.data <- mod %>% data_set(input.conc.data) %>% carry.out(amt) %>% mrgsim(tgrid = TIME.tgrid)#
	conc.data <- as.data.frame(conc.data)#
	plotobj2 <- NULL#
	plotobj2 <- ggplot(conc.data)#
	plotobj2 <- plotobj2 + geom_line(aes(x = time,y = IPRE),colour = "blue")#
	plotobj2 <- plotobj2 + scale_x_continuous("\nTime (hours)")#
	plotobj2 <- plotobj2 + scale_y_log10("Infliximab Concentration (mg/L)\n",breaks = c(0.001,0.01,0.1,1,10,100,100),labels = c(0.001,0.01,0.1,1,10,100,100))#
	plotobj2
rm(list=ls(all=TRUE))#
	library(deSolve)	#
	library(ggplot2)	#
	library(plyr)	#
	library(grid)	#
	library(compiler)	#
	library(mrgsolve)	#
	setwd("/Volumes/Prosecutor/PhD/InfliximabBayes/infliximab-bayes/")#
	theme_bw2 <- theme_set(theme_bw(base_size = 16))#
	sumfuncx <- function(x) {#
		stat1 <- median(x)#
		stat2 <- quantile(x,probs = 0.025,names = F)#
		stat3 <- quantile(x,probs = 0.975,names = F)#
		stat4 <- length(x)#
		result <- c("median" = stat1,"low" = stat2,"hi" = stat3,"n" = stat4)#
		result#
	}#
	set.seed(123456)#
		code <- '#
		$CMT			// Specify compartments#
							CENT,	// Central#
							PERI, // Peripheral#
							TUT,	// Time below target compartment#
							ALB,	// Albumin, U/L#
							WT	// Weight, kg#
		$PARAM		// Population parameters#
							POPCL = 0.294,#
							POPV1 = 3.33,#
							POPQ = 0.0719,#
							POPV2 = 1.14,#
							// Covariate effects#
							WT_CL = 0.614,	// Effect of weight on clearance#
							WT_V1 = 0.691,	// Effect of weight on V1#
							WT_Q = 1.1,	// Effect of weight on Q#
							WT_V2 = 0.59,	// Effect of weight on V2#
							ALB_CL = -1.17,	// Effect of albumin on clearance#
							ADA_CL = 0.257,	// Effect of anti-drug antibodies on clearance#
							// Covariate values for simulation#
							BASE_WT = 70,	// Weight (kg)#
							BASE_ALB = 4,	// Baseline albumin at treatment initiation#
							target = 3	// Target trough concentration (mg/L)#
		$OMEGA		name = "BSV"#
							block = FALSE#
							labels = s(PPVCL,PPVV1,PPVQ,PPVV2)#
							0.106929#
							0.0225#
							1.21#
							0.638401#
		$SIGMA		block = FALSE#
							labels = s(ERRPRO)#
							0.175561#
		$MAIN			// Infusion duration#
							D_CENT = 0.08333333;  // 2 hours#
							// Compartment initial conditions#
							CENT_0 = 0;#
							PERI_0 = 0;#
							TUT_0 = 0;#
							ALB_0 = BASE_ALB;#
							WT_0 = BASE_WT;#
							// Covariate effects#
							double ADACOV = 1;	// No anti-drug antibodies#
							if (ADA == 1) ADACOV = 1+ADA_CL;		// Anti-drug antibodies#
							// Individual parameter values#
							double CL = POPCL*pow(WT/70,WT_CL)*pow(ALB/4,ALB_CL)*ADACOV*exp(PPVCL);#
							double V1 = POPV1*pow(WT/70,WT_V1)*exp(PPVV1);#
							double Q = POPQ*pow(WT/70,WT_Q)*exp(PPVQ);#
							double V2 = POPV2*pow(WT/70,WT_V2)*exp(PPVV2);#
		$ODE			// Differential equations#
							dxdt_CENT = -Q/V1*CENT +Q/V2*PERI -CL/V1*CENT;#
							dxdt_PERI = Q/V1*CENT -Q/V2*PERI;#
							// Time under target#
							double CP = CENT/V1;	// Plasma concentration of the central compartment#
							dxdt_TUT = 0;#
							if (CP < target) dxdt_TUT = 1;#
							// Proportion of time under target#
							double pTUT = 0;#
							if (SOLVERTIME > 0.08333333) pTUT = TUT/SOLVERTIME;#
							// Albumin#
							dxdt_ALB = ALB*((0.1-pTUT)/100);#
							if (ALB < 2) ALB = 2;#
							if (ALB > 6) ALB = 6;#
							// Weight#
							dxdt_WT = WT*((0.1-pTUT)/100);#
							if (WT < 35) WT = 35;#
							if (WT > 110) WT = 110;#
							// Anti-drug antibodies#
							double ADA = 0;#
							if (pTUT > 0.1) ADA = 1;#
		$TABLE		table(IPRE) = CENT/V1;#
							table(DV) = table(IPRE)*exp(ERRPRO);#
		$CAPTURE	WT ADA ALB CL V1 Q V2 PPVCL PPVV1 PPVQ PPVV2 pTUT#
		'#
		mod <- mcode("popINFLIX",code)#
	TIME.tgrid <- tgrid(0,365,1)#
	ID.list <- 1:1000#
		input.conc.data <- data.frame(#
			ID = 1,#
			amt = 5*70,#
			evid = 1,#
			cmt = 1,#
			time = c(0,14,42,98,154,210,266,322),#
			rate = -2#
		)#
	conc.data <- mod %>% data_set(input.conc.data) %>% carry.out(amt) %>% mrgsim(tgrid = TIME.tgrid)#
	conc.data <- as.data.frame(conc.data)#
	plotobj2 <- NULL#
	plotobj2 <- ggplot(conc.data)#
	plotobj2 <- plotobj2 + geom_line(aes(x = time,y = IPRE),colour = "blue")#
	plotobj2 <- plotobj2 + scale_x_continuous("\nTime (hours)")#
	plotobj2 <- plotobj2 + scale_y_log10("Infliximab Concentration (mg/L)\n",breaks = c(0.001,0.01,0.1,1,10,100,100),labels = c(0.001,0.01,0.1,1,10,100,100))#
	plotobj2
>>>>>>> optimise-interval
